import{d as e,h as a,k as l,a as t,Y as o,S as n,a8 as i,b as d,e as s,aE as r,ah as u,ar as p,o as c,W as f,T as m,R as y,V as h,X as g}from"./vue.1709626208081.js";import{a as v}from"./index.170962620808122.js";import{u as _}from"./useCommon.1709626208081.js";import{_ as k,M as w,h as b,E as x}from"./index.1709626208081.js";import C from"./edit.170962620808113.js";import"./validator.1709626208081.js";const j={"class":"page page-full border bg padding"},S={"class":"page page-full-part flex-row gap-4"},L={"class":"custom-tree-node"},T={"class":"tree-label"},W={"class":"page page-full"};var z=k(e({__name:"index",setup(e){const k={children:"children",label:"label"},z=a();r();const B=a([]),I=a(),V=a(),A=a(),D=a(),K=a([]),{params:N,tableData:R,getList:U,loading:E}=_(v.dev_asset_metadata.getList,"Data",{keyWord:""});l((()=>{G()}));const F=e=>{K.value=e.map((e=>e.id))},q=async e=>{e?A.value.open(e,D.value):A.value.open({},D.value)},G=()=>{v.category.getList({}).then((e=>{V.value=e.category,v.product.getLists({}).then((e=>{B.value=e.product,N.productKey=e.product[0].key,U(),I.value=P(B.value,V.value),B.value.length>0&&M(I.value[0].children[0])}))}))},M=e=>{"2"===e.is_type?(D.value=e,N.productKey=e.key,U()):D.value=""},P=(e,a)=>{const l=[];for(let t of a){const a=X(t,e);l.push(a)}return l},X=(e,a)=>{const l={id:e.id,label:e.name,key:e.key,is_type:"1",children:[]};if(e.children&&e.children.length>0)for(let t of e.children){const e=X(t,a);l.children.push(e)}else{const t=a.filter((a=>a.categoryId===e.id));for(let e of t){const a={id:e.id,label:e.name,key:e.key,is_type:"2"};l.children.push(a)}}return l};return(e,a)=>{const l=u("el-input"),r=u("el-form-item"),_=u("ele-Search"),B=u("el-icon"),V=u("el-button"),G=u("ele-FolderAdd"),P=u("el-form"),X=u("SvgIcon"),Y=u("el-tree"),H=u("el-card"),J=u("el-table-column"),O=u("el-table"),Q=u("pagination"),Z=p("auth"),$=p("col"),ee=p("loading");return c(),t("div",j,[o(P,{inline:"",ref_key:"queryRef",ref:z,onKeyup:a[4]||(a[4]=i((e=>s(U)(1)),["enter"]))},{"default":n((()=>[o(r,{label:"关键字：",prop:"keyWord"},{"default":n((()=>[o(l,{modelValue:s(N).keyWord,"onUpdate:modelValue":a[0]||(a[0]=e=>s(N).keyWord=e),placeholder:"请输入关键字",clearable:"",style:{width:"240px"}},null,8,["modelValue"])])),_:1}),o(r,null,{"default":n((()=>[o(V,{type:"primary","class":"ml10",onClick:a[1]||(a[1]=e=>s(U)(1))},{"default":n((()=>[o(B,null,{"default":n((()=>[o(_)])),_:1}),f(" 查询 ")])),_:1})])),_:1}),o(r,null,{"default":n((()=>[D.value?m((c(),y(V,{key:0,type:"primary",onClick:a[2]||(a[2]=e=>q())},{"default":n((()=>[o(B,null,{"default":n((()=>[o(G)])),_:1}),f(" 新增属性 ")])),_:1})),[[Z,"add"]]):h("",!0),m((c(),y(V,{type:"info",onClick:a[3]||(a[3]=e=>{b.confirm("是否确认要批量删除这些数据吗?","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((async()=>{await v.dev_asset_metadata["delete"]({ids:K.value}),x.success("删除成功"),U()}))})},{"default":n((()=>[o(B,null,{"default":n((()=>[o(G)])),_:1}),f(" 删除 ")])),_:1})),[[Z,"batchdel"]])])),_:1})])),_:1},512),d("div",S,[o(H,{style:{width:"250px"},shadow:"nover"},{"default":n((()=>[o(Y,{data:I.value,props:k,accordion:"","default-expand-all":"",onNodeClick:M,"node-key":"id","highlight-current":""},{"default":n((({node:e,data:a})=>[d("div",L,[d("span",T,["2"!=a.is_type?(c(),y(B,{key:0},{"default":n((()=>[o(s(w))])),_:1})):h("",!0),"2"==a.is_type?(c(),y(X,{key:1,name:"iconfont icon-siweidaotu"})):h("",!0),f(" "+g(e.label),1)])])])),_:1},8,["data"])])),_:1}),o(H,{"class":"flex1",shadow:"nover"},{"default":n((()=>[d("div",W,[m((c(),y(O,{data:s(R),onSelectionChange:F,style:{width:"100%"},"row-key":"id"},{"default":n((()=>[o(J,{type:"selection",width:"55",align:"center"}),m(o(J,{prop:"id",label:"ID","min-width":"100","show-overflow-tooltip":""},null,512),[[$,"id"]]),m(o(J,{prop:"name",label:"字段名称","show-overflow-tooltip":""},null,512),[[$,"name"]]),m(o(J,{prop:"title",label:"字段标题","show-overflow-tooltip":""},null,512),[[$,"title"]]),m(o(J,{prop:"types",label:"字段类型","show-overflow-tooltip":""},null,512),[[$,"types"]]),m(o(J,{prop:"createdAt",label:"创建时间",width:"160",align:"center"},null,512),[[$,"createdAt"]]),o(J,{label:"操作",width:"200",align:"center"},{"default":n((e=>[m((c(),y(V,{size:"small",text:"",type:"warning",onClick:a=>q(e.row)},{"default":n((()=>[f("编辑")])),_:2},1032,["onClick"])),[[Z,"edit"]]),m((c(),y(V,{size:"small",text:"",type:"info",onClick:a=>{return l=e.row,void b.confirm('是否确认删除名称为："'+l.name+'"的数据项?',"提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((async()=>{await v.dev_asset_metadata["delete"]({ids:l.id}),x.success("删除成功"),U()}));var l}},{"default":n((()=>[f("删除")])),_:2},1032,["onClick"])),[[Z,"del"]])])),_:1})])),_:1},8,["data"])),[[ee,s(E)]]),s(N).total?(c(),y(Q,{key:0,total:s(N).total,page:s(N).pageNum,"onUpdate:page":a[5]||(a[5]=e=>s(N).pageNum=e),limit:s(N).pageSize,"onUpdate:limit":a[6]||(a[6]=e=>s(N).pageSize=e),onPagination:a[7]||(a[7]=e=>s(U)())},null,8,["total","page","limit"])):h("",!0)])])),_:1})]),o(C,{ref_key:"editFormRef",ref:A,onGetList:a[8]||(a[8]=e=>s(U)(1))},null,512)])}}}),[["__scopeId","data-v-1b702bbf"]]);export{z as default};