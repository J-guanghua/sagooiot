import{a as e}from"./index.17096262080819.js";import{a}from"./index.170962620808122.js";import{a as l}from"./index.170962620808110.js";import{a as t}from"./index.170962620808123.js";import{_ as o,t as n,v as d,w as r,x as i,y as u,z as s,E as p}from"./index.1709626208081.js";import{d as c,h as m,a1 as y,i as g,aa as f,a as v,Y as h,S as b,j as k,e as _,ah as V,o as C,b as x,W as D,X as w,R as K,F,a7 as T,V as U}from"./vue.1709626208081.js";const P=c({name:"Edit",components:{Delete:n,CircleClose:d,Top:r,Bottom:i,CirclePlus:u,Remove:s},setup(o,{emit:n}){const d=m(null),r=m(null),{proxy:i}=k(),{notice_send_gateway:u,alarm_type:s}=i.useDict("notice_send_gateway","alarm_type"),c=y({id:0,isShowDialog:!1,sourceData:[],tempData:[],productData:[],typeData:[],triData:[],operData:[],levelData:[],sendGatewayData:[],noticeConfigData:[],eventList:[],action:[{sendGateway:"",noticeConfig:"",noticeTemplate:"",addressee:[{phone:""}]}],requestParams:[{andOr:"",filters:[{key:"",operator:"",value:"",andOr:0}]}],ruleForm:{id:0,name:"",triggerType:1,eventKey:"",level:"",productKey:"",deviceKey:"",action:[{sendGateway:"",noticeConfig:"",noticeTemplate:"",addressee:{}}],triggerCondition:[{andOr:"",filters:[{key:"",operator:"",value:"",andOr:0}]}]},rules:{name:[{required:!0,message:"告警名称不能为空",trigger:"change"}],level:[{required:!0,message:"告警级别不能为空",trigger:"change"}],productKey:[{required:!0,message:"请选择产品",trigger:"change"}],deviceKey:[{required:!0,message:"请选择设备",trigger:"change"}]}}),v=()=>{a.product.getLists({status:1}).then((e=>{c.productData=e.product||[]})),l.common.operator().then((e=>{c.operData=e.list||[]}))},h=()=>{c.requestParams=[{andOr:"",filters:[{key:"",operator:"",value:"",andOr:0}]}],c.action=[{sendGateway:"",noticeConfig:"",noticeTemplate:"",addressee:[{phone:""}]}],c.ruleForm={id:0,name:"",triggerType:1,level:"",productKey:"",eventKey:"",deviceKey:"",action:[{sendGateway:"",noticeConfig:"",noticeTemplate:"",addressee:{}}],triggerCondition:[{andOr:"",filters:[{key:"",operator:"",value:"",andOr:0}]}]}},b=()=>{c.isShowDialog=!1};g((()=>c.ruleForm.productKey),(e=>{e&&(c.ruleForm.eventKey="",a.product.event({productKey:e}).then((e=>{c.eventList=e||[]})))}));const V=a=>{!a&&(c.ruleForm.deviceKey=""),e.common.getdevList({productKey:c.ruleForm.deviceKey}).then((e=>{c.sourceData=e.device})),l.common.trigger_type(c.ruleForm.productKey).then((e=>{c.typeData=e.list||[]})),C()},C=()=>{c.requestParams=[{andOr:"",filters:[{key:"",operator:"",value:"",andOr:0}]}],function(){c.triData=[];const e=c.ruleForm.triggerType,a={productKey:c.ruleForm.productKey,triggerType:e,eventKey:""};if(4===e&&(a.eventKey=c.ruleForm.eventKey,!a.eventKey))return;l.common.trigger_params(a).then((e=>{c.triData=e.list||[]}))}()};return{alarm_type:s,getRadio:()=>{C()},gettriData:C,getTem:(e,a)=>{c.action[a].noticeTemplate="",t.template.configIddetail(e).then((e=>{c.noticeConfigData[a]=[e]}))},getNode:(e,a)=>{c.action[a].noticeConfig="",t.config.getList({sendGateway:e}).then((e=>{c.sendGatewayData[a]=e.Data}))},delAction:e=>{c.action.splice(e,1)},addAction:()=>{c.action.push({sendGateway:"",noticeConfig:"",noticeTemplate:"",addressee:[{phone:""}]})},eventTypeChange:()=>{C()},AddPhone:e=>{c.action[e].addressee.push({phone:""})},DelPhone:(e,a)=>{c.action[e].addressee.splice(a,1)},setType:V,addParams:e=>{c.requestParams[e].filters.push({key:"",operator:"",value:"",andOr:""})},addParamss:()=>{c.requestParams.push({andOr:"",filters:[{key:"",operator:"",value:"",andOr:""}]})},delParamss:(e,a)=>{c.requestParams[e].filters.splice(a,1)},delParams:e=>{c.requestParams.splice(e,1)},openDialog:e=>{h(),v(),e&&(V(!0),l.common.detail(e.id).then((o=>{c.requestParams=o.data.condition.triggerCondition;let n=o.data.productKey;o.data.performAction.action.forEach((function(e,a){t.config.getList({sendGateway:e.sendGateway}).then((e=>{c.sendGatewayData[a]=e.Data})),e.noticeConfig&&t.template.configIddetail(e.noticeConfig).then((e=>{c.noticeConfigData[a]=[e]}))})),c.action=o.data.performAction.action,c.action.forEach((function(e,a){c.action[a].addressee=e.addressee.map((e=>({phone:e})))})),a.product.event({productKey:o.data.productKey}).then((a=>{c.eventList=a||[],c.ruleForm.eventKey=e.eventKey})),c.ruleForm=o.data,n&&l.common.trigger_type(n).then((e=>{c.typeData=e.list||[]}))}))),c.isShowDialog=!0},closeDialog:b,getDevData:v,onCancel:()=>{b()},onSubmit:()=>{const e=_(r);e&&e.validate((e=>{e&&(c.ruleForm.triggerCondition=c.requestParams,c.action.forEach((function(e,a){c.action[a].addressee=e.addressee.map((e=>e.phone))})),c.ruleForm.action=c.action,0!==c.ruleForm.id?l.common.edit(c.ruleForm).then((()=>{p.success("告警修改成功"),b(),n("dataList")})):l.common.add(c.ruleForm).then((()=>{p.success("告警添加成功"),b(),n("dataList")})))}))},formRef:r,notice_send_gateway:u,myRef:d,...f(c)}}}),O={"class":"system-edit-dic-container"},G={style:{float:"left"}},q={style:{float:"right","font-size":"13px"}},L={style:{float:"left"}},S={style:{float:"right","font-size":"13px"}},A={key:2},R={"class":"box-content"},j={key:0,style:{"text-align":"center"}},z={style:{padding:"10px",border:"1px solid var(--next-border-color-light)","background-color":"var(--next-border-color-light)","margin-bottom":"10px",position:"relative"}},E={"class":"conicon",style:{width:"100%","text-align":"right",position:"absolute",right:"-8px",top:"-8px",color:"red"}},I={style:{display:"flex"}},N={key:0,style:{"text-align":"center"}},B={"class":"content-f"},W={"class":"conicon"},X={"class":"box-content"},Y={style:{padding:"10px",border:"1px solid var(--next-border-color-light)","background-color":"var(--next-border-color-light)","margin-bottom":"10px",position:"relative"}},H={"class":"conicon",style:{width:"100%","text-align":"right",position:"absolute",right:"-8px",top:"-8px",color:"red"}},J={style:{display:"flex"}},M={"class":"content-f"},Q={"class":"dialog-footer"};var Z=o(P,[["render",function(e,a,l,t,o,n){const d=V("el-input"),r=V("el-form-item"),i=V("el-radio"),u=V("el-radio-group"),s=V("el-option"),p=V("el-select"),c=V("el-divider"),m=V("Top"),y=V("el-icon"),g=V("Bottom"),f=V("CircleClose"),k=V("Delete"),_=V("el-button"),P=V("CirclePlus"),Z=V("Remove"),$=V("el-form"),ee=V("el-dialog");return C(),v("div",O,[h(ee,{title:(0!==e.ruleForm.id?"修改":"添加")+"告警",modelValue:e.isShowDialog,"onUpdate:modelValue":a[8]||(a[8]=a=>e.isShowDialog=a),width:"50%"},{footer:b((()=>[x("span",Q,[h(_,{onClick:e.onCancel},{"default":b((()=>[D("取 消")])),_:1},8,["onClick"]),h(_,{type:"primary",onClick:e.onSubmit},{"default":b((()=>[D(w(0!==e.ruleForm.id?"修 改":"添 加"),1)])),_:1},8,["onClick"])])])),"default":b((()=>[e.isShowDialog?(C(),K($,{key:0,model:e.ruleForm,ref:"formRef",rules:e.rules,"label-width":"110px"},{"default":b((()=>[h(r,{label:"名称",prop:"name"},{"default":b((()=>[h(d,{modelValue:e.ruleForm.name,"onUpdate:modelValue":a[0]||(a[0]=a=>e.ruleForm.name=a),placeholder:"请输入名称"},null,8,["modelValue"])])),_:1}),h(r,{label:"告警级别",prop:"level"},{"default":b((()=>[h(u,{modelValue:e.ruleForm.level,"onUpdate:modelValue":a[1]||(a[1]=a=>e.ruleForm.level=a)},{"default":b((()=>[(C(!0),v(F,null,T(e.alarm_type,(e=>(C(),K(i,{label:Number(e.value),key:e.value},{"default":b((()=>[D(w(e.label),1)])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"])])),_:1}),h(r,{label:"选择产品",prop:"productKey"},{"default":b((()=>[h(p,{modelValue:e.ruleForm.productKey,"onUpdate:modelValue":a[2]||(a[2]=a=>e.ruleForm.productKey=a),filterable:"",placeholder:"请选择产品",onChange:a[3]||(a[3]=a=>e.setType())},{"default":b((()=>[(C(!0),v(F,null,T(e.productData,(e=>(C(),K(s,{key:e.key,label:e.name,value:e.key},{"default":b((()=>[x("span",G,w(e.name),1),x("span",q,w(e.key),1)])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),h(r,{label:"选择设备",prop:"deviceKey"},{"default":b((()=>[h(p,{modelValue:e.ruleForm.deviceKey,"onUpdate:modelValue":a[4]||(a[4]=a=>e.ruleForm.deviceKey=a),filterable:"",placeholder:"请选择设备"},{"default":b((()=>[h(s,{label:"全部",value:"all"},{"default":b((()=>[D("全部")])),_:1}),(C(!0),v(F,null,T(e.sourceData,(e=>(C(),K(s,{key:e.key,label:e.name,value:e.key},{"default":b((()=>[x("span",L,w(e.name),1),x("span",S,w(e.key),1)])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),e.ruleForm.productKey?(C(),K(r,{key:0,label:"触发方式",prop:"triggerType"},{"default":b((()=>[h(u,{modelValue:e.ruleForm.triggerType,"onUpdate:modelValue":a[5]||(a[5]=a=>e.ruleForm.triggerType=a),onChange:a[6]||(a[6]=a=>e.getRadio())},{"default":b((()=>[(C(!0),v(F,null,T(e.typeData,(e=>(C(),K(i,{label:e.type,key:e.type},{"default":b((()=>[D(w(e.title),1)])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"])])),_:1})):U("",!0),4===e.ruleForm.triggerType?(C(),K(r,{key:1,label:"选择事件",prop:"eventKey"},{"default":b((()=>[h(p,{modelValue:e.ruleForm.eventKey,"onUpdate:modelValue":a[7]||(a[7]=a=>e.ruleForm.eventKey=a),filterable:"",placeholder:"请选择事件",onChange:e.eventTypeChange},{"default":b((()=>[(C(!0),v(F,null,T(e.eventList,(e=>(C(),K(s,{key:e.key,label:e.name,value:e.key},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1})):U("",!0),e.ruleForm.triggerType>2?(C(),v("div",A,[h(c,{"content-position":"left"},{"default":b((()=>[D("触发条件")])),_:1}),x("div",R,[(C(!0),v(F,null,T(e.requestParams,((a,l)=>(C(),v("div",{key:l},[l>0?(C(),v("div",j,[h(y,null,{"default":b((()=>[h(m)])),_:1}),x("div",null,[h(p,{modelValue:a.andOr,"onUpdate:modelValue":e=>a.andOr=e,placeholder:"选择条件关系"},{"default":b((()=>[h(s,{label:"无",value:0}),h(s,{label:"并且",value:1}),h(s,{label:"或",value:2})])),_:2},1032,["modelValue","onUpdate:modelValue"])]),h(y,null,{"default":b((()=>[h(g)])),_:1})])):U("",!0),x("div",z,[x("div",E,[h(y,{onClick:a=>e.delParams(l)},{"default":b((()=>[h(f)])),_:2},1032,["onClick"])]),x("div",I,[h(c,{"content-position":"left"},{"default":b((()=>[D("参数设置")])),_:1})]),(C(!0),v(F,null,T(a.filters,((a,t)=>(C(),v("div",{key:t},[t>0?(C(),v("div",N,[h(y,null,{"default":b((()=>[h(m)])),_:1}),x("div",null,[h(p,{modelValue:a.andOr,"onUpdate:modelValue":e=>a.andOr=e,placeholder:"选择条件关系",style:{width:"150px"}},{"default":b((()=>[h(s,{label:"无",value:0}),h(s,{label:"并且",value:1}),h(s,{label:"或",value:2})])),_:2},1032,["modelValue","onUpdate:modelValue"])]),h(y,null,{"default":b((()=>[h(g)])),_:1})])):U("",!0),x("div",B,[h(p,{modelValue:a.key,"onUpdate:modelValue":e=>a.key=e,placeholder:4!==e.ruleForm.triggerType||e.ruleForm.eventKey?"选择参数":"请先选择事件",style:{width:"320px"}},{"default":b((()=>[(C(!0),v(F,null,T(e.triData,(e=>(C(),K(s,{key:e.paramKey,label:e.title,value:e.paramKey},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"]),h(p,{modelValue:a.operator,"onUpdate:modelValue":e=>a.operator=e,placeholder:"选择操作符",style:{width:"320px"}},{"default":b((()=>[(C(!0),v(F,null,T(e.operData,(e=>(C(),K(s,{key:e.type,label:e.title,value:e.type},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"]),h(d,{modelValue:a.value,"onUpdate:modelValue":e=>a.value=e,placeholder:"请输入条件值",style:{width:"320px"}},null,8,["modelValue","onUpdate:modelValue"]),x("div",W,[h(y,{onClick:a=>e.delParamss(l,t)},{"default":b((()=>[h(k)])),_:2},1032,["onClick"])])])])))),128)),h(_,{type:"primary","class":"addbutton",onClick:a=>e.addParams(l)},{"default":b((()=>[D("增加条件")])),_:2},1032,["onClick"])])])))),128))]),h(_,{type:"success","class":"addbutton",onClick:e.addParamss},{"default":b((()=>[D("增加分组")])),_:1},8,["onClick"])])):U("",!0),h(c,{"content-position":"left"},{"default":b((()=>[D("执行动作")])),_:1}),x("div",X,[(C(!0),v(F,null,T(e.action,((a,l)=>(C(),v("div",{key:l},[x("div",Y,[x("div",H,[h(y,{onClick:a=>e.delAction(l)},{"default":b((()=>[h(f)])),_:2},1032,["onClick"])]),x("div",J,[h(c,{"content-position":"left"},{"default":b((()=>[D("消息通知")])),_:1})]),x("div",M,[h(p,{modelValue:a.sendGateway,"onUpdate:modelValue":e=>a.sendGateway=e,placeholder:"请选择通知方式",style:{width:"320px"},onChange:t=>e.getNode(a.sendGateway,l)},{"default":b((()=>[(C(!0),v(F,null,T(e.notice_send_gateway,(e=>(C(),K(s,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),h(p,{modelValue:a.noticeConfig,"onUpdate:modelValue":e=>a.noticeConfig=e,placeholder:"请选择通知配置",style:{width:"320px"},onChange:t=>e.getTem(a.noticeConfig,l)},{"default":b((()=>[(C(!0),v(F,null,T(e.sendGatewayData[l],(e=>(C(),K(s,{key:e.id,label:e.title,value:e.id},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),h(p,{modelValue:a.noticeTemplate,"onUpdate:modelValue":e=>a.noticeTemplate=e,placeholder:"请选择通知模板",style:{width:"320px"}},{"default":b((()=>[(C(!0),v(F,null,T(e.noticeConfigData[l],(e=>(C(),K(s,{key:e.id,label:e.title,value:e.id},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])]),x("div",null,[(C(!0),v(F,null,T(a.addressee,((a,t)=>(C(),v("div",{style:{display:"flex","margin-bottom":"10px"},key:t},[h(d,{modelValue:a.phone,"onUpdate:modelValue":e=>a.phone=e,placeholder:"请输入接收人信息",style:{width:"320px"}},null,8,["modelValue","onUpdate:modelValue"]),0==t?(C(),K(y,{key:0,style:{width:"32px",height:"32px","font-size":"24px"},onClick:a=>e.AddPhone(l)},{"default":b((()=>[h(P)])),_:2},1032,["onClick"])):U("",!0),t>0?(C(),K(y,{key:1,style:{width:"32px",height:"32px","font-size":"24px"},onClick:a=>e.DelPhone(l,t)},{"default":b((()=>[h(Z)])),_:2},1032,["onClick"])):U("",!0)])))),128))])])])))),128))]),h(_,{type:"success","class":"addbutton",onClick:e.addAction},{"default":b((()=>[D("增加执行")])),_:1},8,["onClick"])])),_:1},8,["model","rules"])):U("",!0)])),_:1},8,["title","modelValue"])])}],["__scopeId","data-v-31908cd6"]]);export{Z as default};