import{_ as _sfc_main$1}from"./index.170962620808127.js";import{d as defineComponent,a1 as reactive,h as ref,i as watch,k as onMounted,aa as toRefs,a as createElementBlock,Y as createVNode,S as withCtx,b as createBaseVNode,j as getCurrentInstance,aC as useRoute,aE as useRouter,ah as resolveComponent,o as openBlock,F as Fragment,a7 as renderList,R as createBlock,V as createCommentVNode,W as createTextVNode}from"./vue.1709626208081.js";import{a as api$1}from"./index.170962620808130.js";import{_ as _export_sfc,E as ElMessage,b as api$2}from"./index.1709626208081.js";import{a as api}from"./index.170962620808122.js";var edit_vue_vue_type_style_index_0_scoped_true_lang="";const _sfc_main=defineComponent({name:"serverCreate",components:{codeEditor:_sfc_main$1},props:{type:{type:String,"default":""}},setup(props){const{proxy:proxy}=getCurrentInstance(),route=useRoute(),router=useRouter(),{network_server_type:network_server_type,network_protocols:network_protocols}=proxy.useDict("network_server_type","network_protocols"),state=reactive({stickValue:"",stick:{"delimit,omitempty":"","custom,omitempty":"","fixedLen,omitempty":0,"len,omitempty":{len:0,offset:0,endian:""}},stick_type:[{label:"分隔符",value:"分隔符"},{label:"自定义脚本",value:"自定义脚本"},{label:"固定长度",value:"固定长度"},{label:"长度字段",value:"长度字段"}],resourceModalPro:{mode:"",content:""},messageData:[],certificateList:[],detail:{},activeViewName:["1","2","3"],form:{name:"",accessToken:"",authPasswd:"",authUser:"",authType:3,isTls:0,certificateId:"",types:"tcp",status:!1,addr:"",register:{regex:"^w+$"},protocol:{name:"SagooMqtt",options:{}},heartbeat:{enable:!1,hex:"",regex:"^\\w+$",text:"",timeout:30},devices:[]}});api.product.getTypesAll({types:"protocol"}).then((e=>{state.messageData=e||[]}));const mirrorRef=ref("mirrorRef"),activeName=ref("first"),getDetail=()=>{const e=route.params&&route.params.id;api$1.server.getDetail({id:e}).then((e=>{const{id:t,isTls:a,authType:o,certificateId:l,authUser:r,authPasswd:s,accessToken:m,name:c,types:d,status:i,addr:n,register:u,protocol:p,heartbeat:f,devices:V,stick:k}=e;state.form.id=t,state.form.name=c,state.form.types=d,state.form.status=i,state.form.isTls=a,state.form.addr=n,state.form.authType=o,state.form.authUser=r,state.form.authPasswd=s,state.form.accessToken=m,state.form.certificateId=l,state.form.register=JSON.parse(u),state.form.protocol=JSON.parse(p),state.form.heartbeat=JSON.parse(f),state.form.devices=JSON.parse(V);let h=JSON.parse(k);h.len&&h.len.endian?state.stick["len,omitempty"]=h.len:h.fixedLen?state.stick["fixedLen,omitempty"]=h.fixedLen:h.custom?state.stick["custom,omitempty"]=h.custom:h.delimit&&(state.stick["delimit,omitempty"]=h.delimit),"tcp"==d&&(state.stick["delimit,omitempty"]?state.stickValue="分隔符":state.stick["custom,omitempty"]?state.stickValue="自定义脚本":state.stick["fixedLen,omitempty"]?state.stickValue="固定长度":state.stick["len,omitempty"]&&(state.stickValue="长度字段"));let _=JSON.stringify(JSON.parse(p).options);state.resourceModalPro.content=JSON.stringify(JSON.parse(_),null,4),mirrorRef.value.setValue(state.resourceModalPro.content)}))},submit=()=>{let params={...state.form,stick:{...state.stick}};mirrorRef.value.getValue()&&(state.form.protocol.options=eval("("+mirrorRef.value.getValue()+")")),api$1.server.editItem(params).then((e=>{ElMessage.success("修改成功"),goBack()}))},goBack=()=>{router.go(-1)},initData=()=>{state.stick={"delimit,omitempty":"","custom,omitempty":"","fixedLen,omitempty":0,"len,omitempty":{len:0,offset:0,endian:""}}},handleChangeType=()=>{"mqtt_server"==state.form.types||1!=state.form.isTls?0==state.form.isTls&&(state.form.authType=""):state.form.authType=3},getCertificateList=()=>{api$2.certificate.getList().then((e=>{state.certificateList=e.Info}))};return watch((()=>state.form.isTls),(e=>{0==e&&(state.form.authType="")})),onMounted((()=>{getDetail(),getCertificateList()})),{mirrorRef:mirrorRef,activeName:activeName,getDetail:getDetail,network_server_type:network_server_type,network_protocols:network_protocols,submit:submit,initData:initData,handleChangeType:handleChangeType,getCertificateList:getCertificateList,...toRefs(props),...toRefs(state)}}}),_hoisted_1={"class":"page bg padding border page-full Ipt-2",style:{position:"relative"}},_hoisted_2={"class":"collapse-wrap"},_hoisted_3={style:{position:"absolute",right:"20px",top:"14px"}};function _sfc_render(e,t,a,o,l,r){const s=resolveComponent("el-input"),m=resolveComponent("el-form-item"),c=resolveComponent("el-option"),d=resolveComponent("el-select"),i=resolveComponent("el-radio"),n=resolveComponent("el-radio-group"),u=resolveComponent("el-switch"),p=resolveComponent("el-form"),f=resolveComponent("el-collapse-item"),V=resolveComponent("codeEditor"),k=resolveComponent("el-collapse"),h=resolveComponent("el-tab-pane"),_=resolveComponent("el-tabs"),y=resolveComponent("el-button");return openBlock(),createElementBlock("div",_hoisted_1,[createVNode(_,{modelValue:e.activeName,"onUpdate:modelValue":t[20]||(t[20]=t=>e.activeName=t)},{"default":withCtx((()=>[createVNode(h,{label:"编辑服务器",name:"first"},{"default":withCtx((()=>[createVNode(k,{modelValue:e.activeViewName,"onUpdate:modelValue":t[19]||(t[19]=t=>e.activeViewName=t)},{"default":withCtx((()=>[createVNode(f,{title:"基本信息",name:"1"},{"default":withCtx((()=>[createBaseVNode("div",_hoisted_2,[createVNode(p,{style:{width:"600px",margin:"0 auto"},model:e.form,"label-width":"98px"},{"default":withCtx((()=>[createVNode(m,{label:"名称"},{"default":withCtx((()=>[createVNode(s,{modelValue:e.form.name,"onUpdate:modelValue":t[0]||(t[0]=t=>e.form.name=t),"show-word-limit":"",maxlength:"20",placeholder:"请填写名称"},null,8,["modelValue"])])),_:1}),createVNode(m,{label:"类型"},{"default":withCtx((()=>[createVNode(d,{onChange:e.handleChangeType,modelValue:e.form.types,"onUpdate:modelValue":t[1]||(t[1]=t=>e.form.types=t),placeholder:"请选择类型"},{"default":withCtx((()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.network_server_type,(e=>(openBlock(),createBlock(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["onChange","modelValue"])])),_:1}),"tcp"==e.form.types?(openBlock(),createBlock(m,{key:0,label:"粘拆包规则"},{"default":withCtx((()=>[createVNode(d,{onChange:e.initData,modelValue:e.stickValue,"onUpdate:modelValue":t[2]||(t[2]=t=>e.stickValue=t),placeholder:"请选择类型"},{"default":withCtx((()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.stick_type,(e=>(openBlock(),createBlock(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["onChange","modelValue"])])),_:1})):createCommentVNode("",!0),"tcp"==e.form.types&&e.stickValue?(openBlock(),createBlock(m,{key:1},{"default":withCtx((()=>["分隔符"==e.stickValue?(openBlock(),createBlock(m,{key:0,"class":"flex-column",label:"分隔符"},{"default":withCtx((()=>[createVNode(s,{modelValue:e.stick["delimit,omitempty"],"onUpdate:modelValue":t[3]||(t[3]=t=>e.stick["delimit,omitempty"]=t),placeholder:"请填写分隔符"},null,8,["modelValue"])])),_:1})):createCommentVNode("",!0),"自定义脚本"==e.stickValue?(openBlock(),createBlock(m,{key:1,"class":"flex-column",label:"自定义脚本"},{"default":withCtx((()=>[createVNode(s,{modelValue:e.stick["custom,omitempty"],"onUpdate:modelValue":t[4]||(t[4]=t=>e.stick["custom,omitempty"]=t),placeholder:"请填写自定义脚本"},null,8,["modelValue"])])),_:1})):createCommentVNode("",!0),"固定长度"==e.stickValue?(openBlock(),createBlock(m,{key:2,"class":"flex-column",label:"固定长度"},{"default":withCtx((()=>[createVNode(s,{type:"number",modelValue:e.stick["fixedLen,omitempty"],"onUpdate:modelValue":t[5]||(t[5]=t=>e.stick["fixedLen,omitempty"]=t),placeholder:"请填写固定长度"},null,8,["modelValue"])])),_:1})):createCommentVNode("",!0),"长度字段"==e.stickValue?(openBlock(),createBlock(m,{key:3,"class":"flex-column",label:"长度"},{"default":withCtx((()=>[createVNode(s,{type:"number",modelValue:e.stick["len,omitempty"].len,"onUpdate:modelValue":t[6]||(t[6]=t=>e.stick["len,omitempty"].len=t),placeholder:"请填写长度"},null,8,["modelValue"])])),_:1})):createCommentVNode("",!0),"长度字段"==e.stickValue?(openBlock(),createBlock(m,{key:4,"class":"flex-column",label:"偏移量"},{"default":withCtx((()=>[createVNode(s,{type:"number",modelValue:e.stick["len,omitempty"].offset,"onUpdate:modelValue":t[7]||(t[7]=t=>e.stick["len,omitempty"].offset=t),placeholder:"请填写偏移量"},null,8,["modelValue"])])),_:1})):createCommentVNode("",!0),"长度字段"==e.stickValue?(openBlock(),createBlock(m,{key:5,"class":"flex-column",label:"大小端"},{"default":withCtx((()=>[createVNode(d,{modelValue:e.stick["len,omitempty"].endian,"onUpdate:modelValue":t[8]||(t[8]=t=>e.stick["len,omitempty"].endian=t),placeholder:"请选择大小端"},{"default":withCtx((()=>[createVNode(c,{label:"大端",value:"大端"}),createVNode(c,{label:"小端",value:"小端"})])),_:1},8,["modelValue"])])),_:1})):createCommentVNode("",!0)])),_:1})):createCommentVNode("",!0),createVNode(m,{label:"地址"},{"default":withCtx((()=>[createVNode(s,{modelValue:e.form.addr,"onUpdate:modelValue":t[9]||(t[9]=t=>e.form.addr=t),placeholder:"端口号"},null,8,["modelValue"])])),_:1}),createVNode(m,{label:"开启TLS"},{"default":withCtx((()=>[createVNode(n,{modelValue:e.form.isTls,"onUpdate:modelValue":t[10]||(t[10]=t=>e.form.isTls=t),"class":"ml-4"},{"default":withCtx((()=>[createVNode(i,{label:1},{"default":withCtx((()=>[createTextVNode("是")])),_:1}),createVNode(i,{label:0},{"default":withCtx((()=>[createTextVNode("否")])),_:1})])),_:1},8,["modelValue"])])),_:1}),1==e.form.isTls&&"mqtt_server"!=e.form.types?(openBlock(),createBlock(m,{key:2,label:"选择证书"},{"default":withCtx((()=>[createVNode(d,{modelValue:e.form.certificateId,"onUpdate:modelValue":t[11]||(t[11]=t=>e.form.certificateId=t),placeholder:"请选择证书"},{"default":withCtx((()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.certificateList,(e=>(openBlock(),createBlock(c,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):createCommentVNode("",!0),1==e.form.isTls&&"mqtt_server"==e.form.types?(openBlock(),createBlock(m,{key:3,label:"接入方式"},{"default":withCtx((()=>[createVNode(d,{modelValue:e.form.authType,"onUpdate:modelValue":t[12]||(t[12]=t=>e.form.authType=t),placeholder:"选择接入方式"},{"default":withCtx((()=>[createVNode(c,{label:"Basic",value:1}),createVNode(c,{label:"AccessToken",value:2})])),_:1},8,["modelValue"]),1==e.form.authType?(openBlock(),createBlock(m,{key:0,"class":"flex-column",label:"用户名"},{"default":withCtx((()=>[createVNode(s,{modelValue:e.form.authUser,"onUpdate:modelValue":t[13]||(t[13]=t=>e.form.authUser=t),placeholder:"请填写用户名"},null,8,["modelValue"])])),_:1})):createCommentVNode("",!0),1==e.form.authType?(openBlock(),createBlock(m,{key:1,"class":"flex-column",label:"密码"},{"default":withCtx((()=>[createVNode(s,{modelValue:e.form.authPasswd,"onUpdate:modelValue":t[14]||(t[14]=t=>e.form.authPasswd=t),placeholder:"请填写密码"},null,8,["modelValue"])])),_:1})):createCommentVNode("",!0),2==e.form.authType?(openBlock(),createBlock(m,{key:2,"class":"flex-column",label:"Aceess Token"},{"default":withCtx((()=>[createVNode(s,{modelValue:e.form.accessToken,"onUpdate:modelValue":t[15]||(t[15]=t=>e.form.accessToken=t),placeholder:"请填写Aceess Token"},null,8,["modelValue"])])),_:1})):createCommentVNode("",!0)])),_:1})):createCommentVNode("",!0),createVNode(m,{label:"启用"},{"default":withCtx((()=>[createVNode(u,{"active-value":1,"inactive-value":0,modelValue:e.form.status,"onUpdate:modelValue":t[16]||(t[16]=t=>e.form.status=t)},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])])),_:1}),createVNode(f,{title:"注册包",name:"2"},{"default":withCtx((()=>[createVNode(p,{style:{width:"600px",margin:"0 auto"},model:e.form,"label-width":"98px"},{"default":withCtx((()=>[createVNode(m,{label:"正则表达式"},{"default":withCtx((()=>[createVNode(s,{modelValue:e.form.register.regex,"onUpdate:modelValue":t[17]||(t[17]=t=>e.form.register.regex=t),placeholder:"请填写名称"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1}),createVNode(f,{title:"协议适配",name:"3"},{"default":withCtx((()=>[createVNode(p,{style:{width:"600px",margin:"0 auto"},model:e.form,"label-width":"98px"},{"default":withCtx((()=>[createVNode(m,{label:"协议"},{"default":withCtx((()=>[createVNode(d,{modelValue:e.form.protocol.name,"onUpdate:modelValue":t[18]||(t[18]=t=>e.form.protocol.name=t),placeholder:"请选择协议适配"},{"default":withCtx((()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.messageData,(e=>(openBlock(),createBlock(c,{key:e.types,label:e.title,value:e.name},null,8,["label","value"])))),128)),createVNode(c,{label:"Sagoo Mqtt",value:"SagooMqtt"})])),_:1},8,["modelValue"])])),_:1}),createVNode(m,{label:"协议参数"},{"default":withCtx((()=>[createVNode(V,{"class":"params",ref:"mirrorRef",mode:e.resourceModalPro.mode,content:e.resourceModalPro.content},null,8,["mode","content"])])),_:1})])),_:1},8,["model"])])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["modelValue"]),createBaseVNode("div",_hoisted_3,[createVNode(y,{size:"small",onClick:t[21]||(t[21]=t=>e.$router.replace("/iotmanager/network/server"))},{"default":withCtx((()=>[createTextVNode("取消")])),_:1}),createVNode(y,{onClick:e.submit,size:"small",type:"primary"},{"default":withCtx((()=>[createTextVNode("提交")])),_:1},8,["onClick"])])])}var edit=_export_sfc(_sfc_main,[["render",_sfc_render],["__scopeId","data-v-293d52a4"]]);export{edit as default};