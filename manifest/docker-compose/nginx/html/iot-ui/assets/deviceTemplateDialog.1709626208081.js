import{a as e}from"./modbus.1709626208081.js";import{a,b as t,Y as l,S as d,T as i,R as s,Z as o,ah as n,ar as r,o as p,W as u,V as m,F as h,a7 as c,aA as g,aB as f}from"./vue.1709626208081.js";import{_ as b,E as y}from"./index.1709626208081.js";const _={props:{templateNumber:String,mode:Number},data:()=>({tableKey:0,list:[],total:0,listLoading:!1,listQuery:{page:1,size:20,template_number:""},temp:{title:"",unit:"",dataAttribName:"",area:"",dataAddress:"",dataAddressTitle:"",dataType:"",dataInitial:0,dataBaseline:0,dataCoef:1,saveCycle:""},rules:{title:[{required:!0,message:"变量名称",trigger:"blur"}],dataAttribName:[{required:!0,message:"请输入变量编码",trigger:"blur"}],area:[{required:!0,message:"请选择数据区",trigger:"change"}],dataAddress:[{required:!0,message:"请选择数据地址",trigger:"change"}],dataType:[{required:!0,message:"请选择数据类型",trigger:"change"}]},dialogVisible:!1,dialogStatus:"",textMap:{update:"变量详情",create:"添加变量"},dataAreaOptions:[],dataAddressOptions:[],dataTypeOptions:[],normalizer:e=>({id:e.value,label:e.title,children:e.children})}),mounted(){this.listQuery.template_number=this.templateNumber,this.getDict(),this.getList(),this.getDataAreaList()},methods:{getDict(){e.getDict({code:"dataType"}).then((e=>{this.dataTypeOptions=e.list||[]}))},getList(){this.listLoading=!0,e.data.getList(this.listQuery).then((e=>{this.list=e.list||[],this.total=e.Total}))["finally"]((()=>{this.listLoading=!1}))},getDataAreaList(){e.area.getList({template_number:this.templateNumber}).then((e=>{this.dataAreaOptions=e.list||[]}))["finally"]((()=>{}))},handleFilter(){this.getList()},handleDelete(a){this.$confirm('是否确认删除变量名称为"'+a.title+'"的数据项?',"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return e.data.deleteDeviceTemplate({dt_id:a.dtId})})).then((()=>{this.getList(),this.msgSuccess("删除成功")}))},openDialog(e,a){this.dialogStatus=e,a&&(this.temp=Object.assign({},a),this.handleAreaChange(this.temp.area)),this.temp.templateNumber=this.templateNumber,this.dialogVisible=!0,this.$nextTick((()=>{this.$refs.dataForm.clearValidate()}))},closeDialog(){this.dialogVisible=!1,this.temp={title:"",unit:"",dataAttribName:"",area:"",dataAddress:"",dataAddressTitle:"",dataType:"",dataInitial:0,dataBaseline:0,dataCoef:1,saveCycle:""}},createData(){this.$refs.dataForm.validate((a=>{if(a){this.handleSelectChange(this.temp.dataAddress);const a=Object.assign({},this.temp);e.data.addDeviceTemplate(a).then((()=>{this.handleFilter(),this.closeDialog(),y.success("添加成功！")}))}}))},handleUpdate(e){this.openDialog("update",e)},updateData(){this.$refs.dataForm.validate((a=>{if(a){this.handleSelectChange(this.temp.dataAddress);const a=Object.assign({},this.temp);e.data.editDeviceTemplate(a).then((()=>{this.handleFilter(),this.closeDialog(),y.success("操作成功！")}))}}))},handleAreaChange(e){let a=this.dataAreaOptions.find((a=>a.name===e)),t=[];if(!a)return void(this.dataAddressOptions=t);let l=a.length||0;for(let d=0;d<=l;d++)t.push({title:`${a.name}[${d}]`,value:d});this.dataAddressOptions=t},handleSelectChange(e){let a=this.dataAddressOptions.find((a=>a.value===e));this.temp.dataAddressTitle=a?a.title:this.temp.dataAddress}}},V=e=>(g("data-v-a64bb452"),e=e(),f(),e),A={"class":"component-container"},v={"class":"filter-container"},C=V((()=>t("div",{"class":"label"},"数据来源",-1))),D=V((()=>t("div",{"class":"label"},"数据处理",-1)));var T=b(_,[["render",function(e,g,f,b,y,_){const V=n("el-button"),T=n("el-table-column"),k=n("el-table"),U=n("pagination"),w=n("el-input"),O=n("el-form-item"),L=n("el-col"),N=n("el-row"),x=n("el-option"),S=n("el-select"),B=n("el-form"),F=n("el-dialog"),$=r("loading");return p(),a("div",A,[t("div",v,[l(V,{type:"primary",icon:"el-icon-circle-plus-outline",onClick:g[0]||(g[0]=e=>_.openDialog("create"))},{"default":d((()=>[u(" 添加变量列表 ")])),_:1})]),i((p(),s(k,{key:y.tableKey,data:y.list,border:"",fit:"","highlight-current-row":"",style:{width:"100%"}},{"default":d((()=>[l(T,{label:"序号",type:"index",width:"60",align:"center"}),l(T,{label:"变量名",prop:"title",align:"center","show-overflow-tooltip":"","min-width":"180"}),l(T,{label:"变量编码",prop:"dataAttribName",align:"center"}),l(T,{label:"数据地址",prop:"dataAddressTitle",align:"center"}),l(T,{label:"系数",prop:"dataCoef",align:"center"}),l(T,{label:"存盘周期",prop:"saveCycle",align:"center"}),l(T,{label:"操作",align:"center",width:"180"},{"default":d((({row:e,$index:a})=>[l(V,{type:"primary",size:"small",onClick:a=>_.handleUpdate(e)},{"default":d((()=>[u(" 修改 ")])),_:2},1032,["onClick"]),"deleted"!=e.status?(p(),s(V,{key:0,size:"small",type:"danger",onClick:t=>_.handleDelete(e,a)},{"default":d((()=>[u(" 删除 ")])),_:2},1032,["onClick"])):m("",!0)])),_:1})])),_:1},8,["data"])),[[$,y.listLoading]]),i(l(U,{total:y.total,page:y.listQuery.page,"onUpdate:page":g[1]||(g[1]=e=>y.listQuery.page=e),limit:y.listQuery.size,"onUpdate:limit":g[2]||(g[2]=e=>y.listQuery.size=e),onPagination:g[3]||(g[3]=e=>_.getList()),style:{padding:"20px 0 0 !important"}},null,8,["total","page","limit"]),[[o,y.total>0]]),l(F,{title:y.textMap[y.dialogStatus],modelValue:y.dialogVisible,"onUpdate:modelValue":g[16]||(g[16]=e=>y.dialogVisible=e),width:"850px","before-close":_.closeDialog,close:"var-dialog","append-to-body":"","close-on-click-modal":!1},{footer:d((()=>[l(V,{onClick:_.closeDialog},{"default":d((()=>[u(" 取 消 ")])),_:1},8,["onClick"]),l(V,{type:"primary",onClick:g[15]||(g[15]=e=>"create"===y.dialogStatus?_.createData():_.updateData())},{"default":d((()=>[u(" 保 存 ")])),_:1})])),"default":d((()=>[l(B,{ref:"dataForm",rules:y.rules,model:y.temp,"label-position":"right","label-width":"95px"},{"default":d((()=>[l(N,null,{"default":d((()=>[l(L,{span:8},{"default":d((()=>[l(O,{label:"变量名称",prop:"title"},{"default":d((()=>[l(w,{modelValue:y.temp.title,"onUpdate:modelValue":g[4]||(g[4]=e=>y.temp.title=e),placeholder:"请输入变量名称"},null,8,["modelValue"])])),_:1})])),_:1}),l(L,{span:8},{"default":d((()=>[l(O,{label:"变量编码",prop:"dataAttribName"},{"default":d((()=>[l(w,{modelValue:y.temp.dataAttribName,"onUpdate:modelValue":g[5]||(g[5]=e=>y.temp.dataAttribName=e),placeholder:"请输入变量编码"},null,8,["modelValue"])])),_:1})])),_:1}),l(L,{span:8},{"default":d((()=>[l(O,{label:"单位",prop:"unit"},{"default":d((()=>[l(w,{modelValue:y.temp.unit,"onUpdate:modelValue":g[6]||(g[6]=e=>y.temp.unit=e),placeholder:"请输入单位"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),C,l(N,null,{"default":d((()=>[1===f.mode?(p(),s(L,{key:0,span:8},{"default":d((()=>[l(O,{label:"数据区",prop:"area"},{"default":d((()=>[l(S,{modelValue:y.temp.area,"onUpdate:modelValue":g[7]||(g[7]=e=>y.temp.area=e),placeholder:"请选择数据区",filterable:"",onChange:_.handleAreaChange,style:{width:"100%"}},{"default":d((()=>[(p(!0),a(h,null,c(y.dataAreaOptions,((e,a)=>(p(),s(x,{key:a,label:e.name,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1})])),_:1})):m("",!0),1===f.mode?(p(),s(L,{key:1,span:8},{"default":d((()=>[l(O,{label:"数据地址",prop:"dataAddress"},{"default":d((()=>[l(S,{modelValue:y.temp.dataAddress,"onUpdate:modelValue":g[8]||(g[8]=e=>y.temp.dataAddress=e),placeholder:"请选择数据地址",filterable:"","class":"filter-item",onChange:_.handleSelectChange,style:{width:"100%"}},{"default":d((()=>[(p(!0),a(h,null,c(y.dataAddressOptions,((e,a)=>(p(),s(x,{key:a,label:e.title,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1})])),_:1})):m("",!0),0===f.mode?(p(),s(L,{key:2,span:8},{"default":d((()=>[l(O,{label:"数据地址",prop:"dataAddress"},{"default":d((()=>[l(w,{modelValue:y.temp.dataAddress,"onUpdate:modelValue":g[9]||(g[9]=e=>y.temp.dataAddress=e),placeholder:"请输入数据地址"},null,8,["modelValue"])])),_:1})])),_:1})):m("",!0),l(L,{span:8},{"default":d((()=>[l(O,{label:"数据类型",prop:"dataType"},{"default":d((()=>[l(S,{modelValue:y.temp.dataType,"onUpdate:modelValue":g[10]||(g[10]=e=>y.temp.dataType=e),placeholder:"请选择数据类型",filterable:"",style:{width:"100%"}},{"default":d((()=>[(p(!0),a(h,null,c(y.dataTypeOptions,((e,a)=>(p(),s(x,{key:a,label:e.title,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}),D,l(N,null,{"default":d((()=>[l(L,{span:8},{"default":d((()=>[l(O,{label:"初始值",prop:"dataInitial"},{"default":d((()=>[l(w,{modelValue:y.temp.dataInitial,"onUpdate:modelValue":g[11]||(g[11]=e=>y.temp.dataInitial=e),placeholder:"请输入"},null,8,["modelValue"])])),_:1})])),_:1}),l(L,{span:8},{"default":d((()=>[l(O,{label:"基值",prop:"dataBaseline"},{"default":d((()=>[l(w,{modelValue:y.temp.dataBaseline,"onUpdate:modelValue":g[12]||(g[12]=e=>y.temp.dataBaseline=e),placeholder:"请输入"},null,8,["modelValue"])])),_:1})])),_:1}),l(L,{span:8},{"default":d((()=>[l(O,{label:"系数",prop:"dataCoef"},{"default":d((()=>[l(w,{modelValue:y.temp.dataCoef,"onUpdate:modelValue":g[13]||(g[13]=e=>y.temp.dataCoef=e),placeholder:"请输入"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),l(N,null,{"default":d((()=>[l(L,{span:8},{"default":d((()=>[l(O,{label:"存盘周期",prop:"saveCycle"},{"default":d((()=>[l(w,{modelValue:y.temp.saveCycle,"onUpdate:modelValue":g[14]||(g[14]=e=>y.temp.saveCycle=e),placeholder:"请输入"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1},8,["rules","model"])])),_:1},8,["title","modelValue","before-close"])])}],["__scopeId","data-v-a64bb452"]]);export{T as default};