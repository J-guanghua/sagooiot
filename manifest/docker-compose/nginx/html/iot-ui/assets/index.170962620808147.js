import{d as e,h as a,a1 as t,k as l,i as o,aa as s,a as n,Y as d,S as r,ah as i,ar as p,o as u,b as m,X as c,a8 as h,W as f,T as g,R as b,V as w,Z as D}from"./vue.1709626208081.js";import{_ as y,H as x,b as v,h as C,E as N}from"./index.1709626208081.js";import k from"./editUser.1709626208081.js";import{a as U}from"./useCommon.1709626208081.js";import{e as _}from"./rsa.1709626208081.js";const R=e({name:"systemUser",components:{EditUser:k},setup(){const e=a(),n=a(),d=a(""),r=a(),i=x,{statusParams:p}=U(),u=t({loading:!1,ids:[],deptProps:{id:"deptId",children:"children",label:"deptName"},deptData:[],postData:[],roleData:[],tableData:{data:[],total:0,param:{status:-1,pageNum:1,pageSize:10,deptId:"",userNickname:"",userName:"",keyWords:"",mobile:"",dateRange:[]}}}),m=()=>{u.loading=!0,v.user.getList(u.tableData.param).then((e=>{u.tableData.data=e.list,u.tableData.total=e.total}))["finally"]((()=>{u.loading=!1}))};l((()=>{v.dept.getList(p).then((e=>{u.deptData=e})),v.post.getList(p).then((e=>{u.postData=e})),v.role.getList(p).then((e=>{u.roleData=e})),m()})),o(d,(e=>{r.value.filter(e)}));return{queryRef:n,editUserRef:e,onOpenAddUser:()=>{e.value.openDialog()},onOpenEditUser:a=>{e.value.openDialog(a)},onRowDel:e=>{let a="你确定要删除所选用户？";a=`此操作将永久删除用户：“${e.userName}”，是否继续?`,C.confirm(a,"提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((()=>{v.user.del(e.id).then((()=>{N.success("删除成功"),m()}))}))["catch"]((()=>{}))},onHandleSizeChange:e=>{u.tableData.param.pageSize=e},onHandleCurrentChange:e=>{u.tableData.param.pageNum=e},deptFilterNode:(e,a)=>!e||a.deptName.includes(e),filterText:d,treeRef:r,search:i,userList:m,handleSelectionChange:e=>{u.ids=e.map((e=>e.id))},handleNodeClick:e=>{u.tableData.param.deptId=e.deptId,m()},handleResetPwd:e=>{C.prompt('请输入"'+e.userName+'"的新密码',"提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((async({value:a})=>{if(!a||""==a)return void N.success("密码不能为空");let t;t=sessionStorage.isRsaEnabled?await _(a):a,v.user.resetPassword(e.id,t).then((()=>{N.success("修改成功，新密码是："+a)}))}))["catch"]((()=>{}))},handleStatusChange:e=>{let a=1===e.status?"启用":"停用";C.confirm('确认要"'+a+'"："'+e.userName+'"用户吗?',"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return v.user.setStatus(e.id,e.status)})).then((()=>{N.success(a+"成功")}))["catch"]((function(){e.status=0===e.status?1:0}))},resetQuery:e=>{e&&(e.resetFields(),m())},...s(u)}}}),V={"class":"page flex-row gap-4"},S=["title"];var L=y(R,[["render",function(e,a,t,l,o,s){const y=i("el-input"),x=i("el-tree"),v=i("el-scrollbar"),C=i("el-card"),N=i("el-form-item"),k=i("el-option"),U=i("el-select"),_=i("el-date-picker"),R=i("ele-Search"),L=i("el-icon"),P=i("el-button"),T=i("ele-FolderAdd"),z=i("el-form"),E=i("el-table-column"),B=i("el-switch"),j=i("el-table"),A=i("pagination"),W=i("EditUser"),Y=i("EditPer"),F=p("auth"),G=p("col"),I=p("loading");return u(),n("div",V,[d(C,{shadow:"nover",style:{width:"260px"}},{"default":r((()=>[d(v,null,{"default":r((()=>[d(y,{"prefix-icon":e.search,modelValue:e.filterText,"onUpdate:modelValue":a[0]||(a[0]=a=>e.filterText=a),placeholder:"请输入组织名称",clearable:"",style:{width:"100%"}},null,8,["prefix-icon","modelValue"]),d(x,{ref:"treeRef","class":"filter-tree mt-4",data:e.deptData,props:e.deptProps,"default-expand-all":"","filter-node-method":e.deptFilterNode,onNodeClick:e.handleNodeClick},{"default":r((({node:e,data:a})=>[m("div",{"class":"custom-tree-node",title:e.label},c(e.label),9,S)])),_:1},8,["data","props","filter-node-method","onNodeClick"])])),_:1})])),_:1}),d(C,{shadow:"nover","class":"flex1"},{"default":r((()=>[d(z,{model:e.tableData.param,ref:"queryRef",inline:""},{"default":r((()=>[d(N,{label:"",prop:"keyWords"},{"default":r((()=>[d(y,{modelValue:e.tableData.param.keyWords,"onUpdate:modelValue":a[1]||(a[1]=a=>e.tableData.param.keyWords=a),placeholder:"用户名或姓名搜索",clearable:"",style:{width:"165px"},onKeyup:h(e.userList,["enter","native"])},null,8,["modelValue","onKeyup"])])),_:1}),d(N,{label:"",prop:"status"},{"default":r((()=>[d(U,{modelValue:e.tableData.param.status,"onUpdate:modelValue":a[2]||(a[2]=a=>e.tableData.param.status=a),placeholder:"用户状态",style:{width:"80px"}},{"default":r((()=>[d(k,{label:"全部",value:-1}),d(k,{label:"启用",value:1}),d(k,{label:"禁用",value:0})])),_:1},8,["modelValue"])])),_:1}),d(N,{label:"",prop:"dateRange"},{"default":r((()=>[d(_,{modelValue:e.tableData.param.dateRange,"onUpdate:modelValue":a[3]||(a[3]=a=>e.tableData.param.dateRange=a),style:{width:"220px"},"value-format":"YYYY-MM-DD",type:"daterange","range-separator":"-","start-placeholder":"创建时间","end-placeholder":"时间范围"},null,8,["modelValue"])])),_:1}),d(N,null,{"default":r((()=>[d(P,{type:"primary","class":"ml10",onClick:e.userList},{"default":r((()=>[d(L,null,{"default":r((()=>[d(R)])),_:1}),f(" 查询 ")])),_:1},8,["onClick"]),g((u(),b(P,{type:"primary","class":"ml10",onClick:e.onOpenAddUser},{"default":r((()=>[d(L,null,{"default":r((()=>[d(T)])),_:1}),f(" 新增用户 ")])),_:1},8,["onClick"])),[[F,"add"]])])),_:1})])),_:1},8,["model"]),g((u(),b(j,{data:e.tableData.data,style:{width:"100%"},onSelectionChange:e.handleSelectionChange},{"default":r((()=>[d(E,{type:"index",label:"序号",width:"60",align:"center"}),g(d(E,{prop:"userName",label:"用户名","min-width":"120","show-overflow-tooltip":""},null,512),[[G,"userName"]]),g(d(E,{prop:"userNickname",label:"姓名",width:"160","show-overflow-tooltip":""},null,512),[[G,"userNickname"]]),g(d(E,{prop:"dept.deptName",label:"组织","show-overflow-tooltip":""},null,512),[[G,"deptName"]]),g(d(E,{label:"角色","min-width":"120",prop:"rolesNames","show-overflow-tooltip":""},null,512),[[G,"rolesNames"]]),g(d(E,{prop:"mobile",label:"手机号",width:"120",align:"center"},null,512),[[G,"mobile"]]),g((u(),b(E,{prop:"status",label:"用户状态",width:"120",align:"center"},{"default":r((a=>[g(d(B,{modelValue:a.row.status,"onUpdate:modelValue":e=>a.row.status=e,disabled:1===a.row.id,"inline-prompt":"","active-value":1,"inactive-value":0,"active-text":"启","inactive-text":"禁",onChange:t=>e.handleStatusChange(a.row)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"]),[[F,"change-status"]])])),_:1})),[[G,"status"]]),g(d(E,{prop:"createdAt",label:"创建时间",width:"180",align:"center"},null,512),[[G,"createdAt"]]),g((u(),b(E,{label:"操作",width:"130",align:"center",fixed:"right"},{"default":r((a=>[g((u(),b(P,{size:"small",text:"",type:"warning",onClick:t=>e.onOpenEditUser(a.row)},{"default":r((()=>[f("修改")])),_:2},1032,["onClick"])),[[F,"edit"]]),1!==a.row.id?g((u(),b(P,{key:0,size:"small",text:"",type:"info",onClick:t=>e.onRowDel(a.row)},{"default":r((()=>[f("删除")])),_:2},1032,["onClick"])),[[F,"del"]]):w("",!0),g((u(),b(P,{size:"small",text:"",type:"success",onClick:t=>e.handleResetPwd(a.row)},{"default":r((()=>[f("重置")])),_:2},1032,["onClick"])),[[F,"reset"]])])),_:1})),[[G,"handle"]])])),_:1},8,["data","onSelectionChange"])),[[I,e.loading]]),g(d(A,{total:e.tableData.total,page:e.tableData.param.pageNum,"onUpdate:page":a[4]||(a[4]=a=>e.tableData.param.pageNum=a),limit:e.tableData.param.pageSize,"onUpdate:limit":a[5]||(a[5]=a=>e.tableData.param.pageSize=a),onPagination:e.userList},null,8,["total","page","limit","onPagination"]),[[D,e.tableData.total>0]]),d(W,{ref:"editUserRef","dept-data":e.deptData,"post-data":e.postData,"role-data":e.roleData,onGetUserList:e.userList},null,8,["dept-data","post-data","role-data","onGetUserList"]),d(Y,{ref:"editPerRef",onGetUserList:e.userList},null,8,["onGetUserList"])])),_:1})])}]]);export{L as default};