import{d as e,h as a,a1 as t,k as l,aa as n,a as o,T as i,R as s,S as d,Y as u,ah as p,ar as r,o as c,b as m,a8 as f,F as y,a7 as D,W as g,V as h,Z as w}from"./vue.1709626208081.js";import b from"./edit.17096262080817.js";import k from"./excel.1709626208081.js";import{a as _}from"./index.170962620808122.js";import{_ as v,I as x,E as C,h as S}from"./index.1709626208081.js";import"./tag.1709626208081.js";import"./map.1709626208081.js";import"./index.170962620808113.js";import"./index.17096262080818.js";import"./download.1709626208081.js";const R=e({name:"deviceInstance",components:{EditDic:b,ExcelDic:k,ArrowDown:x},setup(){const e=a(),o=a(),i=a(),s=a(),d=a(),u=a(!1),p=t({keys:[],productData:[],tableData:{data:[],total:0,loading:!1,param:{pageNum:1,pageSize:10,name:"",key:"",productKey:"",status:"",dateRange:[]}}}),r=()=>{p.tableData.loading=!0,_.instance.getList(p.tableData.param).then((e=>{p.tableData.data=e.device,p.tableData.total=e.total}))["finally"]((()=>p.tableData.loading=!1))},c=()=>{_.product.getLists().then((e=>{p.productData=e.product}))};l((()=>{r(),c()}));return{addDicRef:e,excelDicRef:i,onOpenexcelDic:e=>{i.value.openDialog(e)},editDicRef:o,detailRef:s,queryRef:d,onActionStatus:e=>{0==e.status?_.instance.devdeploy(e.key).then((e=>{r(),C.success(e.message||"操作成功")})):_.instance.devundeploy(e.key).then((e=>{r(),C.success(e.message||"操作成功")}))},batchLoading:u,setDeviceStatus1:e=>{let a=[];a=e?[e.key]:p.keys,0!==a.length?S.confirm("确认要批量启用这些设备吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((()=>{u.value=!0,_.device.setDeviceStatus({ids:a,status:1}).then((()=>{C.success("启用成功"),r()}))["finally"]((()=>u.value=!1))}))["catch"]((()=>{})):C.error("请选择要操作的数据。")},setDeviceStatus0:e=>{let a=[];a=e?[e.key]:p.keys,0!==a.length?S.confirm("确认要批量禁用这些设备吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((()=>{u.value=!0,_.device.setDeviceStatus({ids:a,status:0}).then((()=>{C.success("禁用成功"),r()}))["finally"]((()=>u.value=!1))}))["catch"]((()=>{})):C.error("请选择要操作的数据。")},onOpenDetail:e=>{s.value.openDialog(e)},onOpenAddDic:()=>{o.value.openDialog()},onOpenEditDic:e=>{o.value.openDialog(e)},onRowDel:e=>{let a="你确定要删除所选数据？",t=[];e?(a=`此操作将永久删除设备：“${e.name}”，是否继续?`,t=[e.key]):t=p.keys,0!==t.length?S.confirm(a,"提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((()=>{_.instance.del(t).then((()=>{C.success("删除成功"),r()}))}))["catch"]((()=>{})):C.error("请选择要删除的数据。")},typeList:r,resetQuery:e=>{e&&(e.resetFields(),r())},handleSelectionChange:e=>{p.keys=e.map((e=>e.key))},...n(p)}}}),V={"class":"page"},L={"class":"system-user-search mb15"},T=m("span",null,"详情",-1);var z=v(R,[["render",function(e,a,t,l,n,b){const k=p("el-input"),_=p("el-form-item"),v=p("el-option"),x=p("el-select"),C=p("el-date-picker"),S=p("ele-Search"),R=p("el-icon"),z=p("el-button"),j=p("ele-FolderAdd"),O=p("ele-Delete"),A=p("arrow-down"),K=p("ele-Open"),U=p("el-dropdown-item"),E=p("ele-TurnOff"),B=p("ele-Upload"),N=p("ele-Download"),Y=p("el-dropdown-menu"),F=p("el-dropdown"),q=p("el-form"),I=p("el-table-column"),M=p("copy"),P=p("el-tag"),Q=p("router-link"),W=p("el-table"),Z=p("pagination"),$=p("el-card"),G=p("EditDic"),H=p("ExcelDic"),J=r("auth"),X=r("col"),ee=r("loading");return c(),o("div",V,[i((c(),s($,{shadow:"nover"},{"default":d((()=>[m("div",L,[u(q,{model:e.tableData.param,ref:"queryRef",inline:""},{"default":d((()=>[u(_,{label:"名称",prop:"name"},{"default":d((()=>[u(k,{modelValue:e.tableData.param.name,"onUpdate:modelValue":a[0]||(a[0]=a=>e.tableData.param.name=a),placeholder:"请输入设备名称",clearable:"",style:{width:"170px"},onKeyup:f(e.typeList,["enter","native"])},null,8,["modelValue","onKeyup"])])),_:1}),u(_,{label:"标识",prop:"key"},{"default":d((()=>[u(k,{modelValue:e.tableData.param.key,"onUpdate:modelValue":a[1]||(a[1]=a=>e.tableData.param.key=a),placeholder:"请输入设备标识",clearable:"",style:{width:"165px"},onKeyup:f(e.typeList,["enter","native"])},null,8,["modelValue","onKeyup"])])),_:1}),u(_,{label:"所属产品",prop:"productKey"},{"default":d((()=>[u(x,{modelValue:e.tableData.param.productKey,"onUpdate:modelValue":a[2]||(a[2]=a=>e.tableData.param.productKey=a),style:{width:"140px"},filterable:"",placeholder:"请选择产品"},{"default":d((()=>[(c(!0),o(y,null,D(e.productData,(e=>(c(),s(v,{key:e.key,label:e.name,value:e.key,"value-key":"id"},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),u(_,{label:"状态",prop:"status"},{"default":d((()=>[u(x,{modelValue:e.tableData.param.status,"onUpdate:modelValue":a[3]||(a[3]=a=>e.tableData.param.status=a),placeholder:"状态",clearable:"",style:{width:"100px"}},{"default":d((()=>[u(v,{label:"在线",value:2}),u(v,{label:"离线",value:1}),u(v,{label:"未启用",value:0})])),_:1},8,["modelValue"])])),_:1}),u(_,{label:"创建时间",prop:"dateRange"},{"default":d((()=>[u(C,{modelValue:e.tableData.param.dateRange,"onUpdate:modelValue":a[4]||(a[4]=a=>e.tableData.param.dateRange=a),style:{width:"240px"},"value-format":"YYYY-MM-DD",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])])),_:1}),u(_,null,{"default":d((()=>[u(z,{type:"primary","class":"ml10",onClick:e.typeList},{"default":d((()=>[u(R,null,{"default":d((()=>[u(S)])),_:1}),g(" 查询 ")])),_:1},8,["onClick"]),i((c(),s(z,{type:"primary","class":"ml10",onClick:e.onOpenAddDic},{"default":d((()=>[u(R,null,{"default":d((()=>[u(j)])),_:1}),g(" 新增 ")])),_:1},8,["onClick"])),[[J,"add"]]),i((c(),s(z,{type:"info","class":"ml10",onClick:a[5]||(a[5]=a=>e.onRowDel())},{"default":d((()=>[u(R,null,{"default":d((()=>[u(O)])),_:1}),g(" 删除 ")])),_:1})),[[J,"del"]]),u(F,null,{dropdown:d((()=>[u(Y,null,{"default":d((()=>[u(U,null,{"default":d((()=>[u(z,{type:"success",onClick:a[6]||(a[6]=a=>e.setDeviceStatus1())},{"default":d((()=>[u(R,null,{"default":d((()=>[u(K)])),_:1}),g(" 批量启用 ")])),_:1})])),_:1}),u(U,null,{"default":d((()=>[u(z,{type:"warning",onClick:a[7]||(a[7]=a=>e.setDeviceStatus0())},{"default":d((()=>[u(R,null,{"default":d((()=>[u(E)])),_:1}),g(" 批量禁用 ")])),_:1})])),_:1}),u(U,null,{"default":d((()=>[u(z,{onClick:a[8]||(a[8]=a=>e.onOpenexcelDic("upload"))},{"default":d((()=>[u(R,null,{"default":d((()=>[u(B)])),_:1}),g(" 导入设备 ")])),_:1})])),_:1}),u(U,null,{"default":d((()=>[u(z,{onClick:a[9]||(a[9]=a=>e.onOpenexcelDic("down"))},{"default":d((()=>[u(R,null,{"default":d((()=>[u(N)])),_:1}),g(" 导出设备 ")])),_:1})])),_:1})])),_:1})])),"default":d((()=>[u(z,{type:"danger","class":"ml10"},{"default":d((()=>[g(" 更多 "),u(R,{"class":"el-icon--right"},{"default":d((()=>[u(A)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])]),i((c(),s(W,{data:e.tableData.data,style:{width:"100%"},onSelectionChange:e.handleSelectionChange},{"default":d((()=>[u(I,{type:"selection",width:"55",align:"center"}),i((c(),s(I,{label:"标识",prop:"key","min-width":"150","show-overflow-tooltip":""},{"default":d((({row:e})=>[u(M,{text:e.key},null,8,["text"])])),_:1})),[[X,"key"]]),i(u(I,{label:"设备名称",prop:"name","min-width":"160","show-overflow-tooltip":""},null,512),[[X,"name"]]),i(u(I,{label:"设备类型",prop:"product.deviceType","min-width":"120",align:"center","show-overflow-tooltip":""},null,512),[[X,"deviceType"]]),i(u(I,{label:"产品名称",prop:"productName","min-width":"120",align:"center","show-overflow-tooltip":""},null,512),[[X,"productName"]]),i((c(),s(I,{prop:"status",label:"状态","min-width":"80",align:"center"},{"default":d((e=>[1==e.row.status?(c(),s(P,{key:0,type:"info",size:"small"},{"default":d((()=>[g("离线")])),_:1})):h("",!0),2==e.row.status?(c(),s(P,{key:1,type:"success",size:"small"},{"default":d((()=>[g("在线")])),_:1})):h("",!0),0==e.row.status?(c(),s(P,{key:2,type:"info",size:"small"},{"default":d((()=>[g("未启用")])),_:1})):h("",!0)])),_:1})),[[X,"status"]]),i(u(I,{prop:"createdAt",label:"创建时间",align:"center",width:"160"},null,512),[[X,"registryTime"]]),i(u(I,{prop:"desc",label:"说明","show-overflow-tooltip":""},null,512),[[X,"desc"]]),u(I,{label:"操作",width:"180",align:"center",fixed:"right"},{"default":d((a=>[i((c(),s(Q,{to:"/iotmanager/device/instance/"+a.row.key,"class":"link-type",style:{"padding-right":"12px","font-size":"12px",color:"#409eff"}},{"default":d((()=>[T])),_:2},1032,["to"])),[[J,"detail"]]),i((c(),s(z,{size:"small",text:"",type:"warning",onClick:t=>e.onOpenEditDic(a.row)},{"default":d((()=>[g("修改")])),_:2},1032,["onClick"])),[[J,"edit"]]),0==a.row.status?i((c(),s(z,{key:0,size:"small",text:"",type:"success",onClick:t=>e.onActionStatus(a.row)},{"default":d((()=>[g("启用")])),_:2},1032,["onClick"])),[[J,"status"]]):h("",!0),a.row.status>0?i((c(),s(z,{key:1,size:"small",text:"",type:"primary",onClick:t=>e.onActionStatus(a.row)},{"default":d((()=>[g("停用")])),_:2},1032,["onClick"])),[[J,"status"]]):h("",!0),i((c(),s(z,{size:"small",text:"",type:"info",onClick:t=>e.onRowDel(a.row)},{"default":d((()=>[g("删除")])),_:2},1032,["onClick"])),[[J,"del"]])])),_:1})])),_:1},8,["data","onSelectionChange"])),[[ee,e.tableData.loading]]),i(u(Z,{total:e.tableData.total,page:e.tableData.param.pageNum,"onUpdate:page":a[10]||(a[10]=a=>e.tableData.param.pageNum=a),limit:e.tableData.param.pageSize,"onUpdate:limit":a[11]||(a[11]=a=>e.tableData.param.pageSize=a),onPagination:e.typeList},null,8,["total","page","limit","onPagination"]),[[w,e.tableData.total>0]])])),_:1})),[[ee,e.batchLoading]]),u(G,{ref:"editDicRef",onTypeList:e.typeList},null,8,["onTypeList"]),u(H,{ref:"excelDicRef",onTypeList:e.typeList},null,8,["onTypeList"])])}]]);export{z as default};