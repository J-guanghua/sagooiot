import{a as e}from"./index.170910578661421.js";import{_ as a,b as l,E as t}from"./index.1709105786614.js";import d from"./from.1709105786614.js";import{r as o}from"./validator.1709105786614.js";import{d as u,h as s,a1 as i,R as n,S as r,n as p,ah as c,o as m,b as v,Y as f,W as y,a as _,a7 as h,X as b,F as V,V as g}from"./vue.1709105786614.js";const k={style:{float:"left"}},K={style:{float:"right","font-size":"13px"}},N={style:{float:"left"}},L={style:{float:"right","font-size":"13px"}},w={key:0},U={key:0},x={"class":"dialog-footer"};var I=a(u({__name:"edit",emits:["getList"],setup(a,{expose:u,emit:I}){const S=I,j=s(!1),C=s(),D=s(),M=s(),Y=s(),z=s(),E=s();s([]);const T={id:void 0,productKey:"",deviceKey:"",deviceName:"",area:"",deviceNumber:"",deviceCategory:"",installTime:"",deptId:"",data:[]},F=e=>{O.data=e},O=i({...T}),P={productKey:[o("所属产品不能为空")],deviceName:[o("设备名称不能为空")],deviceKey:[o("设备不能为空")]},R=e=>{const a=M.value.find((a=>a.key===e));O.deviceName=a?a.name:""},W=async()=>{await C.value.validate();const a=O.id?e.dev_asset.edit:e.dev_asset.add;await a(O),t.success("操作成功"),X(),j.value=!1,S("getList")},X=async()=>{Object.assign(O,{...T}),E.value="",C.value&&C.value.resetFields()},q=e=>{for(let a=0;a<Y.value.length;a++)if(Y.value[a].key===e)return Y.value[a].id;return null};return u({open:async(a,t)=>{X(),j.value=!0,p((()=>{l.org.getList({status:1}).then((e=>{e.forEach((e=>{e.id=e.id.toString()})),D.value=e||[]})),e.product.getLists({}).then((l=>{Y.value=l.product,a.id&&(t={id:q(a.productKey),key:a.productKey}),e.device.allList({productKey:t.key}).then((e=>{M.value=e.device||[]}))})),e.dept.getList({status:-1}).then((e=>{e.forEach((e=>{e.deptId=e.deptId.toString()})),z.value=e||[]})),a.id?e.dev_asset.detail({deviceKey:a.deviceKey}).then((e=>{Object.assign(O,{...e}),O.productKey=a.productKey;const l=e.data.map((e=>{const{name:a,value:l,...t}=e,d={name:a,value:l,...t};return d[a]=l||"",d}));E.value=l})):(e.dev_asset_metadata.getList({productKey:t.key,pageSize:50,pageNum:1,status:-1,total:0}).then((e=>{const a=e.Data.sort(((e,a)=>e.id-a.id));E.value=a||[]})),O.productKey=t.key)}))}}),(e,a)=>{const l=c("el-option"),t=c("el-select"),o=c("el-form-item"),u=c("el-col"),s=c("el-row"),i=c("el-input"),p=c("el-cascader"),I=c("el-date-picker"),S=c("el-divider"),T=c("el-form"),X=c("el-button"),q=c("el-dialog");return m(),n(q,{"class":"api-edit",modelValue:j.value,"onUpdate:modelValue":a[9]||(a[9]=e=>j.value=e),title:""+(O.id?"编辑设备档案":"新增设备档案"),width:"800px","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:r((()=>[v("div",x,[f(X,{onClick:a[8]||(a[8]=e=>j.value=!1)},{"default":r((()=>[y("取消")])),_:1}),f(X,{type:"primary",onClick:W},{"default":r((()=>[y("确定")])),_:1})])])),"default":r((()=>[f(T,{"class":"inline-form",ref_key:"formRef",ref:C,model:O,rules:P,"label-width":"120px"},{"default":r((()=>[f(s,null,{"default":r((()=>[f(u,{span:12},{"default":r((()=>[f(o,{label:"选择产品",prop:"productKey"},{"default":r((()=>[f(t,{modelValue:O.productKey,"onUpdate:modelValue":a[0]||(a[0]=e=>O.productKey=e),placeholder:"请选择产品","class":"w100",disabled:""},{"default":r((()=>[(m(!0),_(V,null,h(Y.value,(e=>(m(),n(l,{key:e.key,label:e.name,value:e.key},{"default":r((()=>[v("span",k,b(e.name),1),v("span",K,b(e.key),1)])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),f(u,{span:12},{"default":r((()=>[f(o,{label:"选择设备",prop:"deviceKey"},{"default":r((()=>[f(t,{modelValue:O.deviceKey,"onUpdate:modelValue":a[1]||(a[1]=e=>O.deviceKey=e),placeholder:"请选择设备","class":"w100",filterable:"",clearable:"",onChange:R},{"default":r((()=>[(m(!0),_(V,null,h(M.value,(e=>(m(),n(l,{key:e.key,label:e.name,value:e.key},{"default":r((()=>[v("span",N,b(e.name),1),v("span",L,b(e.key),1)])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}),f(s,null,{"default":r((()=>[f(u,{span:12},{"default":r((()=>[f(o,{label:"设备名称",prop:"deviceName"},{"default":r((()=>[f(i,{modelValue:O.deviceName,"onUpdate:modelValue":a[2]||(a[2]=e=>O.deviceName=e),modelModifiers:{trim:!0},placeholder:"请输入设备名称",disabled:""},null,8,["modelValue"])])),_:1})])),_:1}),f(u,{span:12},{"default":r((()=>[f(o,{label:"设备编码",prop:"deviceNumber"},{"default":r((()=>[f(i,{modelValue:O.deviceNumber,"onUpdate:modelValue":a[3]||(a[3]=e=>O.deviceNumber=e),modelModifiers:{trim:!0},placeholder:"请输入设备编码"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),f(s,null,{"default":r((()=>[f(u,{span:12},{"default":r((()=>[f(o,{label:"所属区域",prop:"area"},{"default":r((()=>[f(p,{options:D.value,props:{checkStrictly:!0,emitPath:!1,value:"id",label:"name"},placeholder:"请选择区域",clearable:"","class":"w100",modelValue:O.area,"onUpdate:modelValue":a[4]||(a[4]=e=>O.area=e)},{"default":r((({node:e,data:a})=>[v("span",null,b(a.name),1),e.isLeaf?g("",!0):(m(),_("span",w," ("+b(a.children.length)+") ",1))])),_:1},8,["options","modelValue"])])),_:1})])),_:1}),f(u,{span:12},{"default":r((()=>[f(o,{label:"安装时间"},{"default":r((()=>[f(I,{modelValue:O.installTime,"onUpdate:modelValue":a[5]||(a[5]=e=>O.installTime=e),type:"date","value-format":"YYYY-MM-DD",placeholder:"请选择时间","class":"w100",clearable:""},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),f(s,null,{"default":r((()=>[f(u,{span:12},{"default":r((()=>[f(o,{label:"所属部门",prop:"deptId"},{"default":r((()=>[f(p,{options:z.value,props:{checkStrictly:!0,emitPath:!1,value:"deptId",label:"deptName"},placeholder:"请选择所属部门",clearable:"","class":"w100",modelValue:O.deptId,"onUpdate:modelValue":a[6]||(a[6]=e=>O.deptId=e)},{"default":r((({node:e,data:a})=>[v("span",null,b(a.deptName),1),e.isLeaf?g("",!0):(m(),_("span",U," ("+b(a.children.length)+") ",1))])),_:1},8,["options","modelValue"])])),_:1})])),_:1}),f(u,{span:12},{"default":r((()=>[f(o,{label:"设备类型"},{"default":r((()=>[f(i,{modelValue:O.deviceCategory,"onUpdate:modelValue":a[7]||(a[7]=e=>O.deviceCategory=e),modelModifiers:{trim:!0},placeholder:"请输入设备类型"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),E.value?(m(),n(S,{key:0,"content-position":"left"},{"default":r((()=>[y("自定义属性")])),_:1})):g("",!0),E.value&&E.value.length>0?(m(),n(d,{key:1,DataList:E.value,onSetSaveData:F},null,8,["DataList"])):g("",!0)])),_:1},8,["model"])])),_:1},8,["modelValue","title"])}}}),[["__scopeId","data-v-e543fe6a"]]);export{I as default};