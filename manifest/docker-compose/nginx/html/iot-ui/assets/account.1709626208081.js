import{d as e,h as a,a1 as o,k as s,l as t,aa as l,R as n,S as r,aC as i,aE as c,ah as u,o as d,Y as m,a8 as p,b as g,M as f,X as h,j as y}from"./vue.1709626208081.js";import w from"./changePwd.1709626208081.js";import{_ as I,c as _,b as S,u as v,E as P,L as b,S as F,i as C,e as V,f as x}from"./index.1709626208081.js";import{e as N}from"./rsa.1709626208081.js";const R={}.VITE_ISOPEN,k=e({name:"loginAccount",components:{changePwd:w},setup(){const e=a(),{t:n}=_(),r=v(),u=i(),d=c(),{proxy:m}=y(),p=o({isShowPassword:!1,ruleForm:{userName:R?"demo":"",password:R?"demo123456":"",captcha:"",VerifyKey:""},formRules:{userName:[{required:!0,trigger:"blur",message:"用户名不能为空"}],password:[{required:!0,trigger:"blur",message:"密码不能为空"}],captcha:[{required:!0,trigger:"blur",message:"验证码不能为空"}]},loading:{signIn:!1},captchaSrc:""});s((()=>{f()}));const g=t((()=>x(new Date))),f=()=>{S.login.captcha().then((e=>{p.captchaSrc=e.img,p.ruleForm.VerifyKey=e.key}))};const h=async()=>{S.login.currentUser().then((async e=>{localStorage.setItem("userId",e.Info.id),F.set("userMenu",e.Data||[]),r.dispatch("requestOldRoutes/setBackEndControlRoutes",e||[]),r.state.themeConfig.themeConfig.isRequestRoutes?(await V(),w()):(await C(),w())}))},w=()=>{var e,a,o,s;const t=JSON.parse(localStorage.sysinfo||"{}"),l=d.getRoutes().find((e=>"/"===e.path));l&&(l.redirect=t.systemHomePageRoute||"/home");let r=g.value;(null==(e=u.query)?void 0:e.redirect)?d.push({path:null==(a=u.query)?void 0:a.redirect,query:u.query.params&&Object.keys(null==(o=u.query)?void 0:o.params).length>0?JSON.parse(null==(s=u.query)?void 0:s.params):""}):d.push("/"),p.loading.signIn=!1;const i=n("message.signInText");P.success(`${r}，${i}`)};return{changePwdRef:e,onSignIn:()=>{m.$refs.loginForm.validate((async a=>{if(a){let a;p.loading.signIn=!0,a=sessionStorage.isRsaEnabled?await N(p.ruleForm.password):p.ruleForm.password,S.login.login({...p.ruleForm,password:a}).then((async a=>{var o,s,t;if(a.isChangePwd)return P.error(`密码已超过${sessionStorage.sysPasswordChangePeriod}天未修改，请先修改密码再登录`),p.loading.signIn=!1,f(),e.value.toShow({userName:p.ruleForm.userName,oldUserPassword:p.ruleForm.password});localStorage.setItem("token",a.token);const l=a.userInfo;l.avatar=m.getUpFileUrl(l.avatar),b.set("userInfo",l),F.set("userInfo",l);const[n,i,c]=await Promise.all([S.getInfoByKey("sys.column.switch"),S.getInfoByKey("sys.button.switch"),S.getInfoByKey("sys.uploadFile.way")]),u=sessionStorage.isSecurityControlEnabled||null;localStorage.setItem("btnNoAuth",u&&Number(null==(o=null==i?void 0:i.data)?void 0:o.configValue)?"":"1"),localStorage.setItem("colNoAuth",u&&Number(null==(s=null==n?void 0:n.data)?void 0:s.configValue)?"":"1"),localStorage.setItem("uploadFileWay",(null==(t=null==c?void 0:c.data)?void 0:t.configValue)||"0"),await r.dispatch("userInfos/setUserInfos",l),h()}))["catch"]((()=>{p.loading.signIn=!1,f()}))}}))["catch"]((()=>{}))},getCaptcha:f,authLogin:function(e){if("gitee"!==e);else{const e="a0585ded445f240f2adc7957989bdd644fa2cdf0db7d98b0a940ec92df6a0934",a="http://localhost:8888/#/sso/gitee";window.open(`https://gitee.com/oauth/authorize?client_id=${e}&redirect_uri=${encodeURIComponent(a)}&response_type=code`)}},...l(p)}}}),q={"class":"login-content-code"};var U=I(k,[["render",function(e,a,o,s,t,l){const i=u("ele-User"),c=u("el-icon"),y=u("el-input"),w=u("el-form-item"),I=u("ele-Unlock"),_=u("ele-Position"),S=u("el-col"),v=u("el-image"),P=u("el-button"),b=u("changePwd"),F=u("el-form");return d(),n(F,{ref:"loginForm",size:"large","class":"login-content-form",model:e.ruleForm,rules:e.formRules},{"default":r((()=>[m(w,{"class":"login-animation1",prop:"userName"},{"default":r((()=>[m(y,{type:"text",placeholder:e.$t("message.account.accountPlaceholder1"),modelValue:e.ruleForm.userName,"onUpdate:modelValue":a[0]||(a[0]=a=>e.ruleForm.userName=a),clearable:"",autocomplete:"off"},{prefix:r((()=>[m(c,{"class":"el-input__icon"},{"default":r((()=>[m(i)])),_:1})])),_:1},8,["placeholder","modelValue"])])),_:1}),m(w,{"class":"login-animation2",prop:"password"},{"default":r((()=>[m(y,{type:e.isShowPassword?"text":"password",placeholder:e.$t("message.account.accountPlaceholder2"),modelValue:e.ruleForm.password,"onUpdate:modelValue":a[2]||(a[2]=a=>e.ruleForm.password=a),autocomplete:"off",onKeyup:p(e.onSignIn,["enter"])},{prefix:r((()=>[m(c,{"class":"el-input__icon"},{"default":r((()=>[m(I)])),_:1})])),suffix:r((()=>[g("i",{"class":f(["iconfont el-input__icon login-content-password",e.isShowPassword?"icon-yincangmima":"icon-xianshimima"]),onClick:a[1]||(a[1]=a=>e.isShowPassword=!e.isShowPassword)},null,2)])),_:1},8,["type","placeholder","modelValue","onKeyup"])])),_:1}),m(w,{"class":"login-animation3",prop:"captcha"},{"default":r((()=>[m(S,{span:15},{"default":r((()=>[m(y,{type:"text",maxlength:"4",placeholder:e.$t("message.account.accountPlaceholder3"),modelValue:e.ruleForm.captcha,"onUpdate:modelValue":a[3]||(a[3]=a=>e.ruleForm.captcha=a),clearable:"",autocomplete:"off",onKeyup:p(e.onSignIn,["enter"])},{prefix:r((()=>[m(c,{"class":"el-input__icon"},{"default":r((()=>[m(_)])),_:1})])),_:1},8,["placeholder","modelValue","onKeyup"])])),_:1}),m(S,{span:1}),m(S,{span:8},{"default":r((()=>[g("div",q,[m(v,{"class":"login-content-code-img",onClick:e.getCaptcha,width:"130",height:"38",src:e.captchaSrc,style:{cursor:"pointer"}},null,8,["onClick","src"])])])),_:1})])),_:1}),m(w,{"class":"login-animation4"},{"default":r((()=>[m(P,{type:"primary","class":"login-content-submit",onClick:e.onSignIn,loading:e.loading.signIn},{"default":r((()=>[g("span",null,h(e.$t("message.account.accountBtnText")),1)])),_:1},8,["onClick","loading"])])),_:1}),m(b,{ref:"changePwdRef"},null,512)])),_:1},8,["model","rules"])}],["__scopeId","data-v-6f48b06a"]]);export{U as default};