import{d as e,h as l,a as t,Y as a,S as n,e as o,ah as i,ar as s,o as u,a8 as r,W as p,T as d,R as c,X as f,V as m,ag as g}from"./vue.1709626208081.js";import{b as y,h as k,E as h}from"./index.1709626208081.js";import{u as _}from"./useCommon.1709626208081.js";import w from"./edit.170962620808117.js";import"./validator.1709626208081.js";import"./index.170962620808113.js";const b={"class":"page"},x=e({__name:"index",setup(e){const x=l(),C=l();let z=null;const{params:v,tableData:B,getList:T,loading:j}=_(y.plugin.getList,"list",{keyWord:""});T();const S=e=>{if(e)C.value.open(e);else{let e;z=null,k({title:"上传插件",message:g("input",{type:"file",accept:".zip",onchange:function(l){e=l,z=l.target.files[0]}}),showCancelButton:!0,confirmButtonText:"上传",cancelButtonText:"取消",beforeClose:(l,t,a)=>{if("confirm"===l){if(!z)return h("请先上传插件！");t.confirmButtonLoading=!0,t.confirmButtonText="上传中...";const l=new FormData;l.append("file",z),y.plugin.addPluginFile(l).then((()=>{h.success("上传成功"),T(1),a()}))["catch"]((()=>{e.target.value=null}))["finally"]((()=>{t.confirmButtonLoading=!1,t.confirmButtonText="上传"}))}else z=null,a()}})}},L=(e,l)=>{y.plugin.changeStatus({id:e.id,status:l}).then((()=>{h.success("操作成功"),T()}))};return(e,l)=>{const g=i("el-input"),_=i("el-form-item"),z=i("ele-Search"),W=i("el-icon"),F=i("el-button"),P=i("ele-Refresh"),R=i("ele-Plus"),V=i("el-form"),N=i("el-table-column"),U=i("el-tag"),D=i("el-table"),$=i("pagination"),q=i("el-card"),E=s("auth"),G=s("col"),I=s("loading");return u(),t("div",b,[a(q,{shadow:"nover","class":"page-full-part"},{"default":n((()=>[a(V,{model:o(v),ref_key:"queryRef",ref:x,inline:"","label-width":"68px"},{"default":n((()=>[a(_,{label:"关键字",prop:"keyWord"},{"default":n((()=>[a(g,{modelValue:o(v).keyWord,"onUpdate:modelValue":l[0]||(l[0]=e=>o(v).keyWord=e),placeholder:"请输入关键字",clearable:"",style:{width:"180px"},onKeyup:l[1]||(l[1]=r((e=>o(T)(1)),["enter"]))},null,8,["modelValue"])])),_:1}),a(_,null,{"default":n((()=>[a(F,{type:"primary","class":"ml10",onClick:l[2]||(l[2]=e=>o(T)(1))},{"default":n((()=>[a(W,null,{"default":n((()=>[a(z)])),_:1}),p(" 查询 ")])),_:1}),a(F,{onClick:l[3]||(l[3]=e=>(x.value.resetFields(),void T(1)))},{"default":n((()=>[a(W,null,{"default":n((()=>[a(P)])),_:1}),p(" 重置 ")])),_:1}),d((u(),c(F,{type:"primary",onClick:l[4]||(l[4]=e=>S())},{"default":n((()=>[a(W,null,{"default":n((()=>[a(R)])),_:1}),p(" 上传插件ZIP ")])),_:1})),[[E,"upload"]])])),_:1})])),_:1},8,["model"]),d((u(),c(D,{data:o(B),style:{width:"100%"}},{"default":n((()=>[a(N,{label:"序号",align:"center",width:"80"},{"default":n((({$index:e})=>[p(f(o(v).pageSize*(o(v).pageNum-1)+(e+1)),1)])),_:1}),d(a(N,{label:"名称",align:"center",prop:"name"},null,512),[[G,"name"]]),d(a(N,{label:"插件类型",align:"center",prop:"types"},null,512),[[G,"types"]]),d(a(N,{label:"功能类型",align:"center",prop:"handleType"},null,512),[[G,"handleType"]]),d(a(N,{label:"说明","show-overflow-tooltip":"",align:"left",prop:"description"},null,512),[[G,"description"]]),d(a(N,{label:"作者",align:"center",prop:"author"},null,512),[[G,"author"]]),d((u(),c(N,{label:"状态",align:"center",prop:"status",width:"80"},{"default":n((e=>[1===e.row.status?(u(),c(U,{key:0,type:"success",size:"small"},{"default":n((()=>[p("正常")])),_:1})):0===e.row.status?(u(),c(U,{key:1,type:"error",size:"small"},{"default":n((()=>[p("停用")])),_:1})):-1===e.row.status?(u(),c(U,{key:2,type:"info",size:"small"},{"default":n((()=>[p("全部")])),_:1})):(u(),c(U,{key:3,type:"info",size:"small"},{"default":n((()=>[p("-")])),_:1}))])),_:1})),[[G,"status"]]),d((u(),c(N,{label:"操作",width:"180",align:"center",fixed:"right"},{"default":n((e=>[1==e.row.status?d((u(),c(F,{key:0,type:"warning",size:"small",link:"",onClick:l=>L(e.row,0)},{"default":n((()=>[p("停用")])),_:2},1032,["onClick"])),[[E,"stop"]]):m("",!0),0==e.row.status?d((u(),c(F,{key:1,size:"small",type:"success",link:"",onClick:l=>L(e.row,1)},{"default":n((()=>[p("启用")])),_:2},1032,["onClick"])),[[E,"start"]]):m("",!0),0==e.row.status?d((u(),c(F,{key:2,size:"small",type:"info",link:"",onClick:l=>{return t=e.row,void k.confirm(`此操作将删除插件：“${t.name}”，是否继续?`,"提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((async()=>{await y.plugin.del([t.id]),h.success("删除成功"),T(1)}));var t}},{"default":n((()=>[p("删除")])),_:2},1032,["onClick"])),[[E,"del"]]):m("",!0),a(F,{size:"small",type:"plain",link:"",onClick:l=>S(e.row)},{"default":n((()=>[p("编辑")])),_:2},1032,["onClick"])])),_:1})),[[G,"handle"]])])),_:1},8,["data"])),[[I,o(j)]]),o(v).total?(u(),c($,{key:0,total:o(v).total,page:o(v).pageNum,"onUpdate:page":l[5]||(l[5]=e=>o(v).pageNum=e),limit:o(v).pageSize,"onUpdate:limit":l[6]||(l[6]=e=>o(v).pageSize=e),onPagination:l[7]||(l[7]=e=>o(T)())},null,8,["total","page","limit"])):m("",!0)])),_:1}),a(w,{ref_key:"editFormRef",ref:C,onGetList:l[8]||(l[8]=e=>o(T)(1))},null,512)])}}});export{x as default};