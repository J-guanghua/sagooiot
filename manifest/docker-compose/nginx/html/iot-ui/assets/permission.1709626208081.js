import{_ as e,b as l,E as a}from"./index.1709626208081.js";import{d as u,h as t,R as s,S as n,ah as d,o,b as v,Y as i,W as c}from"./vue.1709626208081.js";const r={"class":"mb-4 tr"},h={"class":"scroll-part mt-3"};var p=e(u({__name:"permission",setup(e,{expose:u}){const p=t(!1),f=t(!1),m=t(1),k=t(),_=t("角色权限设置"),y=t(0),C=t([]),b=t([]),g=t([]),w=t([]),I=t([]),K=t([]),x=t([]),E=t([]),R=t([]),V=t([]),$=t([]),j=["menu","button","column","api"];let D=[K,E,V,$];const H=[b,g,w,I],L={children:"children",label:"title"},N=(e,l=!1)=>{const a=[],u=[];return(e||[]).forEach((e=>{const[l,t]=e.split("_");"1"===t?a.push(Number(l)):u.push(Number(l))})),l?u:a},A=(e,l=!1)=>e.map((e=>`${e}_${l?0:1}`)),M=()=>{p.value=!1},S=e=>{const l=k.value.store.nodesMap;for(let a in l)l[a].expanded=e},U=async()=>{Y(),C.value=H[m.value-2].value,k.value.setCheckedKeys(D[m.value-2].value),m.value=m.value-1},W=async()=>{Y();const e=await l.role.auth.getList(j[m.value],K.value.concat(x.value)),a=j[m.value],u=(e||[]).filter((e=>{var l;return!!(null==(l=e.children)?void 0:l.length)&&(e.id+="_memu","api"===a&&e.children.forEach((e=>{e.title=e.method+"-"+e.title+(e.remark?`(${e.remark})`:"")})),!0)}));C.value=u,H[m.value].value=u,k.value.setCheckedKeys(D[m.value].value),m.value=m.value+1},Y=()=>{1===m.value?(D[m.value-1].value=k.value.getCheckedKeys(!1),x.value=k.value.getHalfCheckedKeys()):2===m.value?(D[m.value-1].value=k.value.getCheckedKeys(!1).filter((e=>"number"==typeof e)),R.value=k.value.getHalfCheckedKeys().filter((e=>"number"==typeof e))):D[m.value-1].value=k.value.getCheckedKeys(!0)},q=e=>{if(e){const e=B(H[m.value-1].value,[]);k.value.setCheckedKeys(e)}else k.value.setCheckedKeys([])},z=async()=>{Y();const e={menuIds:A(K.value).concat(A(x.value,!0)),buttonIds:A(E.value).concat(A(R.value,!0)),columnIds:A(V.value),apiIds:A($.value),roleId:y.value};f.value=!0,l.role.auth.set(e).then((()=>{a.success("权限设置成功")}))["finally"]((()=>{f.value=!1,p.value=!1}))};function B(e,l){var a;for(let u of e)l.push(u.id),(null==(a=u.children)?void 0:a.length)&&B(u.children,l);return l}return u({openDialog:async e=>{_.value="角色权限设置 - "+e.name,y.value=e.id,p.value=!0,m.value=1;const a=await l.role.getRoleIds(e.id);K.value=N(a.menuIds),E.value=N(a.buttonIds),V.value=N(a.columnIds),$.value=N(a.apiIds),k.value.setCheckedKeys(K.value);const u=await l.role.auth.getList(j[m.value-1]);C.value=u,b.value=u}}),(e,l)=>{const a=d("ele-ArrowDown"),u=d("el-icon"),t=d("el-button"),y=d("el-dropdown-item"),b=d("el-dropdown-menu"),g=d("el-dropdown"),w=d("el-step"),I=d("el-steps"),K=d("el-tree"),x=d("el-dialog");return o(),s(x,{title:_.value,modelValue:p.value,"onUpdate:modelValue":l[4]||(l[4]=e=>p.value=e),width:"1100px"},{"default":n((()=>[v("div",r,[i(g,null,{dropdown:n((()=>[i(b,null,{"default":n((()=>[i(y,{onClick:l[0]||(l[0]=e=>q(!0))},{"default":n((()=>[c("全部勾选")])),_:1}),i(y,{onClick:l[1]||(l[1]=e=>q(!1))},{"default":n((()=>[c("取消全选")])),_:1}),i(y,{onClick:l[2]||(l[2]=e=>S(!0))},{"default":n((()=>[c("展开所有")])),_:1}),i(y,{onClick:l[3]||(l[3]=e=>S(!1))},{"default":n((()=>[c("折叠所有")])),_:1})])),_:1})])),"default":n((()=>[i(t,{plain:"","class":"mr-3"},{"default":n((()=>[c(" 操作"),i(u,null,{"default":n((()=>[i(a)])),_:1})])),_:1})])),_:1}),i(t,{disabled:m.value<=1,onClick:U},{"default":n((()=>[c("上一步")])),_:1},8,["disabled"]),i(t,{disabled:m.value>=4,onClick:W},{"default":n((()=>[c("下一步")])),_:1},8,["disabled"]),i(t,{type:"primary",loading:f.value,onClick:z},{"default":n((()=>[c("确定")])),_:1},8,["loading"]),i(t,{onClick:M},{"default":n((()=>[c("取消")])),_:1})]),i(I,{active:m.value,simple:"","finish-status":"success"},{"default":n((()=>[i(w,{name:"",title:"菜单权限"}),i(w,{title:"按钮权限"}),i(w,{title:"列表权限"}),i(w,{title:"接口权限"})])),_:1},8,["active"]),v("div",h,[i(K,{ref_key:"treeRef",ref:k,data:C.value,"show-checkbox":"","default-expand-all":"","node-key":"id","highlight-current":"",props:L,"check-on-click-node":"","expand-on-click-node":!1},null,8,["data"])])])),_:1},8,["title","modelValue"])}}}),[["__scopeId","data-v-39308784"]]);export{p as default};