import{i as e,L as t}from"./echarts.1709105786614.js";import{d as a,H as l,i as o,h as i,a1 as r,k as n,aG as s,aa as m,a as c,Y as d,S as h,j as u,aE as f,ah as g,ar as p,o as b,F as v,a7 as C,R as y,b as D,X as w,M as x,O as _,W as O,T,V as F,n as L,aA as A,aB as M}from"./vue.1709105786614.js";import{_ as S,u as k,d as z}from"./index.1709105786614.js";import{a as E}from"./index.17091057866148.js";import Y from"./edit.1709105786614.js";import R from"./detail.1709105786614.js";import"./index.17091057866149.js";/* empty css                     */let j={homeChartOne:null,homeChartTwo:null,homeCharThree:null,dispose:[null,"",void 0]};const V=a({name:"home",components:{EditDic:Y,DetailDic:R},setup(){let a,c;l((()=>{clearInterval(a),clearInterval(c)}));const{proxy:d}=u(),{alarm_type:h}=d.useDict("alarm_type"),g={};o((()=>h.value),(e=>{e.length&&(e.forEach((e=>{g[e.value]=e.label})),A())}),{immediate:!0});const p=i(),b=i(),v=i(),C=i(),y=i(),D=k(),w=f(),x=r({loading:!1,tableData:{data:[],total:0,loading:!1,param:{pageNum:1,pageSize:10,status:"",dateRange:[]}},homeOne:[{allnum:0,num1:0,num2:0,num3:"产品",num4:"icon-zidingyibuju",color1:"#6690F9",color2:"--el-color-warning-lighter",color3:"--el-color-warning",icoimg:"index_product.svg",title1:"启用",title2:"停用",title1_bgcolor:"#3cd357",title2_bgcolor:"#c1bbbb"},{allnum:0,num1:0,num2:0,num3:"在线设备",num4:"icon-putong",color1:"#FF6462",color2:"--next-color-primary-lighter",color3:"--el-color-primary",icoimg:"index_device.svg",title1:"启用",title2:"停用",title1_bgcolor:"#3cd357",title2_bgcolor:"#c1bbbb"},{allnum:0,num1:0,num2:0,num3:"设备消息",num4:"icon-shidu",color1:"#6690F9",color2:"--el-color-success-lighter",color3:"--el-color-success",icoimg:"index_sensor.svg",title1:"本月",title2:"今日",title1_bgcolor:"#c1bbbb",title2_bgcolor:"#18f3ff"},{allnum:0,num1:0,num2:0,num3:"设备告警",num4:"icon-zaosheng",color1:"#6690F9",color2:"--el-color-warning-lighter",color3:"--el-color-warning",icoimg:"index_alarm.svg",title1:"本月",title2:"今日",title1_bgcolor:"#c1bbbb",title2_bgcolor:"#ff1818"}],myCharts:[],charts:{theme:"",bgColor:"",color:"#303133"},lineChartXAxisData:[],lineChartMsgTotalData:[],lineChartAlarmTotalData:[],pieChartLegend:[],pieChartLevel:[],pieChartData:[]}),_=()=>{j.dispose.some((e=>e===j.homeChartOne))||j.homeChartOne.dispose(),j.homeChartOne=e(v.value,x.charts.theme);const a={backgroundColor:x.charts.bgColor,title:{text:"设备消息",x:"left",textStyle:{fontSize:"15",color:x.charts.color}},grid:{top:70,right:20,bottom:30,left:50},tooltip:{trigger:"axis"},legend:{data:["消息量","预警量"],right:0},xAxis:{data:x.lineChartXAxisData},yAxis:[{type:"value",name:"条数",splitLine:{show:!0,lineStyle:{type:"dashed",color:"#f5f5f5"}},axisLabel:{margin:2,formatter:function(e){return e>=1e4&&e<1e7?e=e/1e4+"W":e>=1e7&&(e=e/1e7+"KW"),e}}}],series:[{name:"消息量",type:"line",symbolSize:6,symbol:"circle",smooth:!0,data:x.lineChartMsgTotalData,lineStyle:{color:"#fe9a8b"},itemStyle:{color:"#fe9a8b",borderColor:"#fe9a8b"},areaStyle:{color:new t(0,0,0,1,[{offset:0,color:"#fe9a8bb3"},{offset:1,color:"#fe9a8b03"}])}},{name:"预警量",type:"line",symbolSize:6,symbol:"circle",smooth:!0,data:x.lineChartAlarmTotalData,lineStyle:{color:"#9E87FF"},itemStyle:{color:"#9E87FF",borderColor:"#9E87FF"},areaStyle:{color:new t(0,0,0,1,[{offset:0,color:"#9E87FFb3"},{offset:1,color:"#9E87FF03"}])},emphasis:{itemStyle:{color:{type:"radial",x:.5,y:.5,r:.5,colorStops:[{offset:0,color:"#9E87FF"},{offset:.4,color:"#9E87FF"},{offset:.5,color:"#fff"},{offset:.7,color:"#fff"},{offset:.8,color:"#fff"},{offset:1,color:"#fff"}]},borderColor:"#9E87FF",borderWidth:2}}}]};j.homeChartOne.setOption(a),x.myCharts.push(j.homeChartOne)},O=()=>{j.dispose.some((e=>e===j.homeChartTwo))||j.homeChartTwo.dispose(),j.homeChartTwo=e(C.value,x.charts.theme);for(var t=x.pieChartLegend,a=x.pieChartData,l=[],o=0;o<t.length;o++)l.push({name:t[o],value:a[o]});const i=["#FF0000","#FEC279","#968AF5","#51A3FC","#669"],r={color:x.pieChartLevel.map((e=>i[e-1])),backgroundColor:x.charts.bgColor,title:{text:"预警类型",x:"left",textStyle:{fontSize:"15",color:x.charts.color}},tooltip:{trigger:"item",formatter:"{b} <br/> {c}%"},graphic:{elements:[{type:"image",z:-1,left:"16.5%",top:"center"}]},legend:{type:"scroll",orient:"vertical",right:"0%",left:"65%",top:"center",itemWidth:14,itemHeight:14,data:t,textStyle:{rich:{name:{fontSize:14,fontWeight:400,width:200,height:35,padding:[0,0,0,60],color:x.charts.color},rate:{fontSize:15,fontWeight:500,height:35,width:40,padding:[0,0,0,30],color:x.charts.color}}}},series:[{type:"pie",radius:["70","90"],center:["32%","50%"],itemStyle:{},label:{show:!1},labelLine:{show:!1},data:l}]};j.homeChartTwo.setOption(r),x.myCharts.push(j.homeChartTwo)},T=()=>{L((()=>{for(let e=0;e<x.myCharts.length;e++)setTimeout((()=>{x.myCharts[e].resize()}),1e3*e)}))};function F(){E.iotManage.productCount().then((e=>{x.homeOne[0].allnum=e.total,x.homeOne[0].num1=e.enable,x.homeOne[0].num2=e.disable})),E.iotManage.deviceDataTotalCount("year").then((e=>{x.homeOne[2].allnum=e.number})),E.iotManage.deviceDataTotalCount("month").then((e=>{x.homeOne[2].num1=e.number})),E.iotManage.deviceDataTotalCount("day").then((e=>{x.homeOne[2].num2=e.number})),E.iotManage.deviceOnlineOfflineCount().then((e=>{x.homeOne[1].allnum=e.online,x.homeOne[1].num1=e.total-e.disable,x.homeOne[1].num2=e.disable})),E.iotManage.deviceAlarmLevelCount("year",z().format("YYYY")).then((e=>{const t=(e.data||[]).reduce(((e,t)=>e+t.Value),0);x.homeOne[3].allnum=t})),E.iotManage.deviceAlarmLevelCount("month",z().format("M")).then((e=>{const t=(e.data||[]).reduce(((e,t)=>e+t.Value),0);x.homeOne[3].num1=t})),E.iotManage.deviceAlarmLevelCount("day",z().format("D")).then((e=>{const t=(e.data||[]).reduce(((e,t)=>e+t.Value),0);x.homeOne[3].num2=t}))}function A(){Promise.all([E.iotManage.deviceDataCount("year"),E.iotManage.deviceAlertCountByYearMonth(z().format("YYYY"))]).then((([e,t])=>{const a=(null==e?void 0:e.data)||[],l=(null==t?void 0:t.data)||[];x.lineChartMsgTotalData=a.map((e=>e.Value)),x.lineChartXAxisData=a.map((e=>e.Title)),x.lineChartAlarmTotalData=l.map((e=>e.Value))})),E.iotManage.deviceAlarmLevelCount("year",z().format("YYYY")).then((e=>{const t=(e.data||[]).sort(((e,t)=>t.Title-e.Title));x.pieChartLegend=t.map((e=>g[e.Title])),x.pieChartLevel=t.map((e=>e.Title)),x.pieChartData=t.map((e=>e.Value))}))}a=setInterval(F,3e3),c=setInterval(A,6e4);const M=()=>{F()},S=()=>{E.iotManage.getAlarmList(x.tableData.param).then((e=>{x.tableData.data=e.list,x.tableData.total=e.Total}))};return n((()=>{window.addEventListener("resize",T),M(),S()})),s((()=>{T()})),o((()=>D.state.tagsViewRoutes.isTagsViewCurrenFull),(()=>{T()})),o((()=>x.lineChartAlarmTotalData),(()=>{_()})),o((()=>x.pieChartData),(()=>{O()})),o((()=>D.state.themeConfig.themeConfig.isIsDark),(e=>{L((()=>{x.charts.theme=e?"dark":"",x.charts.bgColor=e?"transparent":"",x.charts.color=e?"#dadada":"#303133",setTimeout((()=>{_()}),500),setTimeout((()=>{O()}),700)}))}),{deep:!0,immediate:!0}),o((()=>x.lineChartMsgTotalData),(()=>{_()})),o((()=>x.pieChartData),(()=>{O()})),{homeLineRef:v,homePieRef:C,homeBarRef:y,detailRef:b,editDicRef:p,toMore:()=>{w.push({path:"/iotmanager/alarm/log"})},onOpenEditDic:e=>{p.value.openDialog(e)},getAlarmList:S,onOpenDetailDic:e=>{b.value.openDialog(e)},getOverviewData:M,...m(x)}}}),I={"class":"home-container"},W={"class":"home-card-item"},K={"class":"flex-auto"},X={"class":"font30"},B={"class":"home-card-item-icon flex"},N=["src"],P={"class":"flex",style:{"font-weight":"bold"}},H={"class":"flex font14"},G={"class":"flex ml20 font14"},$={"class":"home-card-item"},q={style:{height:"100%"},ref:"homeLineRef"},J={"class":"home-card-item"},Q={style:{height:"100%"},ref:"homePieRef"},U={"class":"home-card-item",style:{height:"auto"}},Z={"class":"home-card-item-title"},ee=(e=>(A("data-v-381e3cce"),e=e(),M(),e))((()=>D("span",null,"告警信息列表",-1))),te={key:0},ae={key:1};var le=S(V,[["render",function(e,t,a,l,o,i){const r=g("el-col"),n=g("el-row"),s=g("el-button"),m=g("el-table-column"),u=g("el-tag"),f=g("el-table"),L=g("EditDic"),A=g("DetailDic"),M=p("col"),S=p("auth"),k=p("loading");return b(),c("div",I,[d(n,{gutter:15,"class":"home-card-one mb15"},{"default":h((()=>[(b(!0),c(v,null,C(e.homeOne,((e,t)=>(b(),y(r,{xs:24,sm:12,md:12,lg:6,xl:6,key:t,"class":x({"home-media home-media-lg":t>1,"home-media-sm":1===t})},{"default":h((()=>[D("div",W,[D("div",null,w(e.num3),1),D("div",{"class":x(["flex-margin flex w100",` home-one-animation${t}`])},[D("div",K,[D("span",X,w(e.allnum),1)]),D("div",B,[D("img",{src:"/imgs/"+e.icoimg,"class":"icoimg"},null,8,N)])],2),D("div",P,[D("div",H,[D("div",{"class":"title_status",style:_({backgroundColor:e.title1_bgcolor})},null,4),O(" "+w(e.title1)+" "+w(e.num1),1)]),D("div",G,[D("div",{"class":"title_status",style:_({backgroundColor:e.title2_bgcolor})},null,4),O(w(e.title2)+" "+w(e.num2),1)])])])])),_:2},1032,["class"])))),128))])),_:1}),d(n,{gutter:15,"class":"home-card-two mb15"},{"default":h((()=>[d(r,{xs:24,sm:14,md:14,lg:16,xl:16},{"default":h((()=>[D("div",$,[D("div",q,null,512)])])),_:1}),d(r,{xs:24,sm:10,md:10,lg:8,xl:8,"class":"home-media"},{"default":h((()=>[D("div",J,[D("div",Q,null,512)])])),_:1})])),_:1}),d(n,{gutter:15,"class":"home-card-three"},{"default":h((()=>[d(r,{xs:24,sm:24,md:24,lg:24,xl:24},{"default":h((()=>[D("div",U,[D("div",Z,[ee,d(s,{size:"small",text:"",type:"primary",onClick:t[0]||(t[0]=t=>e.toMore())},{"default":h((()=>[O("更多信息")])),_:1})]),T((b(),y(f,{data:e.tableData.data,style:{width:"100%"}},{"default":h((()=>[T(d(m,{label:"ID",align:"center",prop:"id",width:"100"},null,512),[[M,"ID"]]),T((b(),y(m,{label:"告警类型",width:"120",prop:"type",align:"center","show-overflow-tooltip":""},{"default":h((e=>[1==e.row.type?(b(),c("span",te,"规则告警")):(b(),c("span",ae,"设备自主告警"))])),_:1})),[[M,"type"]]),T(d(m,{label:"规则级别",width:"120",align:"center",prop:"alarmLevel.name","show-overflow-tooltip":""},null,512),[[M,"alarmLevel"]]),T(d(m,{label:"规则名称",prop:"ruleName","show-overflow-tooltip":""},null,512),[[M,"ruleName"]]),T(d(m,{label:"产品标识",prop:"productKey","show-overflow-tooltip":""},null,512),[[M,"productKey"]]),T(d(m,{label:"设备标识",prop:"deviceKey","show-overflow-tooltip":""},null,512),[[M,"deviceKey"]]),T((b(),y(m,{prop:"status",label:"告警状态",width:"100",align:"center"},{"default":h((e=>[e.row.status?(b(),y(u,{key:0,type:"success",size:"small"},{"default":h((()=>[O("已处理")])),_:1})):(b(),y(u,{key:1,type:"info",size:"small"},{"default":h((()=>[O("未处理")])),_:1}))])),_:1})),[[M,"status"]]),T(d(m,{prop:"createdAt",label:"告警时间",align:"center",width:"170"},null,512),[[M,"createdAt"]]),T((b(),y(m,{label:"操作",width:"130",align:"center",fixed:"right"},{"default":h((t=>[T((b(),y(s,{size:"small",text:"",type:"primary",onClick:a=>e.onOpenDetailDic(t.row)},{"default":h((()=>[O("详情")])),_:2},1032,["onClick"])),[[S,"detail"]]),0==t.row.status?T((b(),y(s,{key:0,size:"small",text:"",type:"warning",onClick:a=>e.onOpenEditDic(t.row)},{"default":h((()=>[O("处理")])),_:2},1032,["onClick"])),[[S,"edit"]]):F("",!0)])),_:1})),[[M,"handle"]])])),_:1},8,["data"])),[[k,e.loading]])])])),_:1})])),_:1}),d(L,{ref:"editDicRef",onDataList:e.getAlarmList},null,8,["onDataList"]),d(A,{ref:"detailRef",onDataList:e.getAlarmList},null,8,["onDataList"])])}],["__scopeId","data-v-381e3cce"]]);export{le as default};