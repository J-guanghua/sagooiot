import{a as e}from"./index.170962620808122.js";import{_ as l,b as a,E as o}from"./index.1709626208081.js";import t from"./tag.1709626208081.js";import r from"./map.1709626208081.js";import{u}from"./index.170962620808113.js";import{c as d}from"./index.17096262080818.js";import{d as s,h as n,a1 as i,aa as m,a as c,Y as p,S as f,e as g,ah as h,o as y,b as F,W as V,X as b,F as k,a7 as I,R as _,V as v}from"./vue.1709626208081.js";const T={id:0,key:"",name:"",productKey:"",tags:[],lng:"",lat:"",version:"",authType:0,authUser:"",authPasswd:"",accessToken:"",certificateId:"",desc:"",extensionInfo:"",address:""},U=s({name:"deviceEditPro",components:{tagVue:t,Map:r,UploadVue:u},setup(l,{emit:t}){const r=n(null),u=n(null),s=n(),c=n([]),p=i({isShowDialog:!1,product:{},productData:[],ruleForm:{...T},rules:{name:[{required:!0,message:"设备名称不能为空",trigger:"blur"}],key:[{required:!0,message:"设备标识不能为空",trigger:"blur"}],productKey:[{required:!0,message:"所属产品不能为空",trigger:"blur"}]},deviceImgLimit:0,certificateLimit:0,phone:"",certificate:"",intro:""}),f=()=>{p.ruleForm={...T}},h=()=>{p.isShowDialog=!1};const y=l=>{e.product.detail(l).then((e=>{const{authType:l,authUser:a,authPasswd:o,accessToken:t,certificateId:r}=e.data;p.product=e.data,p.ruleForm.authType=l,p.ruleForm.authUser=a,p.ruleForm.authPasswd=o,p.ruleForm.accessToken=t,p.ruleForm.certificateId=r}))};return{certList:c,productKeyChange:y,tagRef:u,selectMap:e=>{s.value.openDialog(e)},mapRef:s,updateMap:e=>{p.ruleForm.lng=e.lng,p.ruleForm.lat=e.lat,p.ruleForm.address=e.address},delTagRow:function(e){p.ruleForm.tags.splice(e,1)},toAddTag:function(){u.value.addRow()},addTag:function(e){p.ruleForm.tags.push(e)},openDialog:l=>{f(),a.getInfoByKey("sys.device.phone.limit").then((e=>{p.deviceImgLimit=parseInt(e.data.configValue)})),a.getInfoByKey("sys.device.certificate.limit").then((e=>{p.certificateLimit=parseInt(e.data.configValue)})),d.certificateManagement.getAll().then((e=>{c.value=e.Info||[]})),e.product.getLists({status:1}).then((e=>{p.productData=e.product||[]})),l&&(p.ruleForm=l,p.ruleForm.tags=l.tags||[],p.phone=l.extensionInfo?JSON.parse(l.extensionInfo).phone:[],p.certificate=l.extensionInfo?JSON.parse(l.extensionInfo).certificate:[],p.intro=l.extensionInfo?JSON.parse(l.extensionInfo).intro:"",y(l.productKey)),p.isShowDialog=!0},closeDialog:h,onCancel:()=>{h()},onSubmit:()=>{const l=g(r);l&&l.validate((l=>{if(l)if(0!==p.ruleForm.id){const l={...p.ruleForm,extensionInfo:JSON.stringify({phone:p.phone,certificate:p.certificate,intro:p.intro})};e.instance.edit(l).then((()=>{o.success("设备类型修改成功"),h(),t("typeList")}))}else{const l={...p.ruleForm,extensionInfo:JSON.stringify({phone:p.phone,certificate:p.certificate,intro:p.intro})};e.instance.add(l).then((()=>{o.success("设备类型添加成功"),h(),t("typeList")}))}}))},setImgsPhone:e=>{p.phone=e},setImgsCertificate:e=>{p.certificate=e},formRef:r,...m(p)}}}),w={"class":"system-edit-dic-container"},x={"class":"tags-wrapper"},C={"class":"tags"},S={"class":"dialog-footer"};var D=l(U,[["render",function(e,l,a,o,t,r){const u=h("el-input"),d=h("el-form-item"),s=h("el-option"),n=h("el-select"),i=h("el-button"),m=h("el-tag"),g=h("el-radio"),T=h("el-radio-group"),U=h("uploadVue"),D=h("el-form"),K=h("el-dialog"),R=h("tagVue"),L=h("Map");return y(),c("div",w,[p(K,{title:(0!==e.ruleForm.id?"修改":"添加")+"设备",modelValue:e.isShowDialog,"onUpdate:modelValue":l[12]||(l[12]=l=>e.isShowDialog=l),width:"769px"},{footer:f((()=>[F("span",S,[p(i,{onClick:e.onCancel},{"default":f((()=>[V("取 消")])),_:1},8,["onClick"]),p(i,{type:"primary",onClick:e.onSubmit},{"default":f((()=>[V(b(0!==e.ruleForm.id?"修 改":"添 加"),1)])),_:1},8,["onClick"])])])),"default":f((()=>[p(D,{model:e.ruleForm,ref:"formRef",rules:e.rules,"label-width":"110px"},{"default":f((()=>[p(d,{label:"设备标识",prop:"key"},{"default":f((()=>[p(u,{modelValue:e.ruleForm.key,"onUpdate:modelValue":l[0]||(l[0]=l=>e.ruleForm.key=l),placeholder:"请输入设备标识",disabled:e.ruleForm.id},null,8,["modelValue","disabled"])])),_:1}),p(d,{label:"设备名称",prop:"name"},{"default":f((()=>[p(u,{modelValue:e.ruleForm.name,"onUpdate:modelValue":l[1]||(l[1]=l=>e.ruleForm.name=l),placeholder:"请输入设备名称"},null,8,["modelValue"])])),_:1}),p(d,{label:"所属产品",prop:"productKey"},{"default":f((()=>[p(n,{modelValue:e.ruleForm.productKey,"onUpdate:modelValue":l[2]||(l[2]=l=>e.ruleForm.productKey=l),onChange:e.productKeyChange,disabled:e.ruleForm.id,placeholder:"请选择所属产品","class":"w100"},{"default":f((()=>[(y(!0),c(k,null,I(e.productData,(e=>(y(),_(s,{key:e.id,label:e.name,value:e.key},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange","disabled"])])),_:1}),p(d,{label:"设备坐标",prop:"lng"},{"default":f((()=>[p(u,{value:e.ruleForm.lng?e.ruleForm.lng+" , "+e.ruleForm.lat:"",placeholder:"选择设备坐标",onClick:l[3]||(l[3]=l=>e.selectMap(e.ruleForm)),"read-only":""},null,8,["value"])])),_:1}),p(d,{label:"标签设置",prop:"lng"},{"default":f((()=>[F("div",x,[p(i,{type:"primary",size:"small",onClick:e.toAddTag},{"default":f((()=>[V("添加标签")])),_:1},8,["onClick"]),F("div",C,[(y(!0),c(k,null,I(e.ruleForm.tags,((l,a)=>(y(),c("div",{"class":"tag flex",key:l.key},[p(m,null,{"default":f((()=>[V(b(l.key)+" : "+b(l.name)+" : "+b(l.value),1)])),_:2},1024),p(i,{type:"danger",size:"small",onClick:l=>e.delTagRow(a)},{"default":f((()=>[V("删除")])),_:2},1032,["onClick"])])))),128))])])])),_:1}),1===e.ruleForm.authType||2===e.ruleForm.authType?(y(),c(k,{key:0},[p(d,{label:"认证方式",prop:""},{"default":f((()=>[p(T,{modelValue:e.ruleForm.authType,"onUpdate:modelValue":l[4]||(l[4]=l=>e.ruleForm.authType=l)},{"default":f((()=>[p(g,{label:1},{"default":f((()=>[V("Basic")])),_:1}),p(g,{label:2},{"default":f((()=>[V("AccessToken")])),_:1})])),_:1},8,["modelValue"])])),_:1}),1===e.ruleForm.authType?(y(),c(k,{key:0},[p(d,{label:"用户名",prop:"authUser"},{"default":f((()=>[p(u,{modelValue:e.ruleForm.authUser,"onUpdate:modelValue":l[5]||(l[5]=l=>e.ruleForm.authUser=l),placeholder:"请输入用户名"},null,8,["modelValue"])])),_:1}),p(d,{label:"密码",prop:"authPasswd"},{"default":f((()=>[p(u,{type:"password",modelValue:e.ruleForm.authPasswd,"onUpdate:modelValue":l[6]||(l[6]=l=>e.ruleForm.authPasswd=l),placeholder:"请输入密码"},null,8,["modelValue"])])),_:1})],64)):(y(),_(d,{key:1,label:"Aceess Token",prop:"accessToken"},{"default":f((()=>[p(u,{modelValue:e.ruleForm.accessToken,"onUpdate:modelValue":l[7]||(l[7]=l=>e.ruleForm.accessToken=l),placeholder:"请输入Aceess Token"},null,8,["modelValue"])])),_:1}))],64)):3===e.ruleForm.authType?(y(),_(d,{key:1,label:"认证证书",prop:"certificateId"},{"default":f((()=>[p(n,{modelValue:e.ruleForm.certificateId,"onUpdate:modelValue":l[8]||(l[8]=l=>e.ruleForm.certificateId=l),placeholder:"请选择证书"},{"default":f((()=>[(y(!0),c(k,null,I(e.certList,(e=>(y(),_(s,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):v("",!0),p(d,{label:"固件版本号",prop:"version"},{"default":f((()=>[p(u,{modelValue:e.ruleForm.version,"onUpdate:modelValue":l[9]||(l[9]=l=>e.ruleForm.version=l),placeholder:"请输入固件版本号"},null,8,["modelValue"])])),_:1}),p(d,{label:"备注",prop:"desc"},{"default":f((()=>[p(u,{modelValue:e.ruleForm.desc,"onUpdate:modelValue":l[10]||(l[10]=l=>e.ruleForm.desc=l),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])])),_:1}),p(d,{label:"设备说明"},{"default":f((()=>[p(u,{modelValue:e.intro,"onUpdate:modelValue":l[11]||(l[11]=l=>e.intro=l),type:"textarea",placeholder:"请输入设备说明"},null,8,["modelValue"])])),_:1}),p(d,{label:"设备图片"},{"default":f((()=>[p(U,{img:e.phone,onSetImgs:e.setImgsPhone},null,8,["img","onSetImgs"])])),_:1}),p(d,{label:"证书图片"},{"default":f((()=>[p(U,{img:e.certificate,onSetImgs:e.setImgsCertificate},null,8,["img","onSetImgs"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue"]),p(R,{ref:"tagRef"},null,512),p(L,{ref:"mapRef",onUpdateMap:e.updateMap},null,8,["onUpdateMap"])])}],["__scopeId","data-v-234c40c5"]]);export{D as default};